<!-- A html document -->
<!-- 
with standard nbconvert css layout
with standard nbconvert input/output content
standard html tag wrapping
with mathjax loaded
with jupyter wigets
 caption and label elements according to ipub meta tags  
with fuzzingbook adaptations -->None
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" /><title>Statistical Debugging - The Debugging Book</title>

<style type="text/css">
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
    </style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  }
  div.output_wrapper {
    display: block;
    page-break-inside: avoid;
  }
  div.output {
    display: block;
    page-break-inside: avoid;
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true }
    }
});
</script>
<!-- End of mathjax configuration --><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<!--[if IE lte 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<style type="text/css">
.ipyfigure { display: -ms-flex; display: -webkit-flex; display: flex;}
.ipyfigure>div { flex:1; }
.ipytable { display: -ms-flex; display: -webkit-flex; display: flex;}
.ipytable>div { flex:1; }

</style>

<link href='https://fonts.googleapis.com/css?family=Fira+Mono:400,500,700|Raleway:300|Source+Code+Pro|Open+Sans' rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<meta property="og:url" content="https://www.debuggingbook.org/beta/html/StatisticalDebugger.html" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Statistical Debugging - The Debugging Book" />
<meta property="og:description" content="In this chapter, we introduce statistical debugging – the idea that specific events during execution could be statistically correlated with failures. We start with coverage of individual lines and then proceed towards further execution features.Prerequisites You should have read the chapter on tracing executions." />
<meta property="og:image" content="https://www.debuggingbook.org/beta/html/PICS/wordcloud.png" />

<meta name="twitter:dnt" content="on">

<link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-touch-icon.png">

<meta name="msapplication-TileColor" content="#B03A2E">
<meta name="msapplication-config" content="favicon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">

<meta name="viewport" content="width=device-width, initial-scale=1"></head>
 <body>

    <script>
    var close_menus = function() {
        /* doesn't work yet - AZ
        console.log("Closing menus")
        var cssmenu = document.getElementById("cssmenu")
        var all_items = cssmenu.getElementsByTagName("li");
        var i;
        for (i = 0; i < all_items.length; i++) {
            item = all_items[i];
            // console.log("<li>: ")
            // console.log(item.innerHTML);
            var j;
            var all_ul = item.getElementsByTagName("ul");
            for (j = 0; j < all_ul.length; j++) {
                console.log("<ul>: ")
                console.log(all_ul[j].innerHTML);
                all_ul[j].style.display = "none";
            }
            var all_ol = item.getElementsByTagName("ol");
            for (j = 0; j < all_ol.length; j++) {
                console.log("<ol>: ")
                console.log(all_ol[j].innerHTML);
                all_ol[j].style.display = "none";
            }
        }
        */
    };

    $( document ).ready( close_menus );

    // Let navbar fade away when scrolling down
    var prevScrollpos = window.pageYOffset;
    window.onscroll = function() {
        var currentScrollPos = window.pageYOffset;
        if (currentScrollPos > 10 && currentScrollPos > prevScrollpos) {
            // Hide navbar
            var cssmenu = document.getElementById("cssmenu")
            cssmenu.style.opacity = 0;

            // When scrolling, also close all sub-menus
            close_menus();
        }
        else {
            // Make navbar visible
            document.getElementById("cssmenu").style.opacity = 1;
        }
        prevScrollpos = currentScrollPos;
    };
    </script>
    
<nav>
<div id="cssmenu">
  <ul>
     <li class="has-sub"><a href="#"><span title="The Debugging Book"><i class="fa fa-fw fa-bars"></i> </span><span class="menu_1">The Debugging Book&nbsp;<i class="fa fa-fw fa-wrench"></i></span></a>
        <ol>
           
<li><a href="https://www.debuggingbook.org/beta/"><span class="part_number"><i class="fa fa-fw fa-home"></i></span> About this book</a></li>
<li><a href="https://www.debuggingbook.org/beta/html/00_Table_of_Contents.html"><i class="fa fa-fw fa-sitemap"></i></span> Sitemap</a></li>
<li class="has-sub"><a href="01_Intro.html" class="chapters"><span class="part_number">I</span> Whetting Your Appetite <strong class="new_chapter">&bull;</strong> <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="Tours.html">Tours through the Book <strong class="new_chapter">&bull;</strong></a></li>
<li><a href="Intro_Debugging.html">Introduction to Debugging <strong class="new_chapter">&bull;</strong></a></li>
</ul><li class="has-sub"><a href="02_Observing.html" class="chapters"><span class="part_number">II</span> Observing Executions <strong class="new_chapter">&bull;</strong> <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="Tracer.html">Tracing Executions <strong class="new_chapter">&bull;</strong></a></li>
<li><a href="Debugger.html">How Debuggers Work <strong class="new_chapter">&bull;</strong></a></li>
<li><a href="Assertions.html">Asserting Expectations</a></li>
<li><a href="PerformanceDebugger.html">Debugging Performance Issues&nbsp;<i class="fa fa-fw fa-wrench"></i></a></li>
</ul><li class="has-sub"><a href="03_Dependencies.html" class="chapters"><span class="part_number">III</span> Flows and Dependencies <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="Slicer.html">Tracking Failure Origins</a></li>
</ul><li class="has-sub"><a href="04_Reducing.html" class="chapters"><span class="part_number">IV</span> Reducing Failure Causes <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="DeltaDebugger.html">Reducing Failure-Inducing Inputs</a></li>
<li><a href="ChangeDebugger.html">Isolating Failure-Inducing Changes</a></li>
<li><a href="ThreadDebugger.html">Debugging Concurrent Programs&nbsp;<i class="fa fa-fw fa-wrench"></i></a></li>
</ul><li class="has-sub"><a href="05_Abstracting.html" class="chapters"><span class="part_number">V</span> Abstracting Failures <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="StatisticalDebugger.html" class="this_page">Statistical Debugging</a></li>
<li><a href="DynamicInvariants.html">Mining Function Specifications</a></li>
<li><a href="DDSetDebugger.html">Generalizing Failure Circumstances</a></li>
</ul><li class="has-sub"><a href="06_Repairing.html" class="chapters"><span class="part_number">VI</span> Automatic Repair <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="Repairer.html">Repairing Code Automatically</a></li>
</ul><li class="has-sub"><a href="07_In_the_Large.html" class="chapters"><span class="part_number">VII</span> Debugging in the Large <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="Tracking.html">Tracking Bugs</a></li>
<li><a href="ChangeCounter.html">Where the Bugs are</a></li>
</ul><li class="has-sub"><a href="99_Appendices.html" class="chapters">Appendices <i class="fa fa-fw fa-caret-right"></i></a>
<ul>
<li><a href="ExpectError.html">Error Handling</a></li>
<li><a href="Timer.html">Timer</a></li>
<li><a href="ClassDiagram.html">Class Diagrams</a></li>
<li><a href="StackInspector.html">Inspecting Call Stacks</a></li>
</ul>
           <li><a href="https://www.debuggingbook.org/beta/html/00_Index.html">Index (beta)</a></i></li>
        </ol>
     </li>
     <li class="has-sub"><a href="#"><span title="Statistical Debugging"><i class="fa fa-fw fa-list-ul"></i></span> <span class="menu_2">Statistical Debugging</span></a>
           <ul><li class="has-sub"><a href="#Synopsis"><i class="fa fa-fw fa-map"></i> Synopsis</a>
<ul><li class="has-sub"><a href="#Collecting-Events-from-Calls">Collecting Events from Calls</a>
</li><li class="has-sub"><a href="#Collecting-Events-from-Tests">Collecting Events from Tests</a>
</li><li class="has-sub"><a href="#Visualizing-Events-as-a-Table">Visualizing Events as a Table</a>
</li><li class="has-sub"><a href="#Visualizing-Suspicious-Code">Visualizing Suspicious Code</a>
</li><li class="has-sub"><a href="#Ranking-Events">Ranking Events</a>
</li><li class="has-sub"><a href="#Classes-and-Methods">Classes and Methods</a>
</ul></li><li class="has-sub"><a href="#Introduction">&nbsp;&bull;&nbsp;&nbsp; Introduction</a>
</li><li class="has-sub"><a href="#Collecting-Events">&nbsp;&bull;&nbsp;&nbsp; Collecting Events</a>
<ul><li class="has-sub"><a href="#Error-Prevention">Error Prevention</a>
</ul></li><li class="has-sub"><a href="#Collecting-Coverage">&nbsp;&bull;&nbsp;&nbsp; Collecting Coverage</a>
</li><li class="has-sub"><a href="#Computing-Differences">&nbsp;&bull;&nbsp;&nbsp; Computing Differences</a>
<ul><li class="has-sub"><a href="#A-Base-Class-for-Statistical-Debugging">A Base Class for Statistical Debugging</a>
</li><li class="has-sub"><a href="#Excursion:-Printing-an-Event-Table">Excursion: Printing an Event Table</a>
</li><li class="has-sub"><a href="#Collecting-Passing-and-Failing-Runs">Collecting Passing and Failing Runs</a>
</li><li class="has-sub"><a href="#Analyzing-Events">Analyzing Events</a>
</ul></li><li class="has-sub"><a href="#Visualizing-Differences">&nbsp;&bull;&nbsp;&nbsp; Visualizing Differences</a>
<ul><li class="has-sub"><a href="#Discrete-Spectrum">Discrete Spectrum</a>
</li><li class="has-sub"><a href="#Continuous-Spectrum">Continuous Spectrum</a>
</ul></li><li class="has-sub"><a href="#Ranking-Lines-by-Suspiciousness">&nbsp;&bull;&nbsp;&nbsp; Ranking Lines by Suspiciousness</a>
<ul><li class="has-sub"><a href="#The-Tarantula-Metric">The Tarantula Metric</a>
</li><li class="has-sub"><a href="#The-Ochiai-Metric">The Ochiai Metric</a>
</li><li class="has-sub"><a href="#How-Useful-is-Ranking?">How Useful is Ranking?</a>
</ul></li><li class="has-sub"><a href="#Using-Large-Test-Suites">&nbsp;&bull;&nbsp;&nbsp; Using Large Test Suites</a>
</li><li class="has-sub"><a href="#Other-Events-besides-Coverage">&nbsp;&bull;&nbsp;&nbsp; Other Events besides Coverage</a>
</li><li class="has-sub"><a href="#Training-Classifiers">&nbsp;&bull;&nbsp;&nbsp; Training Classifiers</a>
<ul><li class="has-sub"><a href="#Collecting-Events-from-Calls">Collecting Events from Calls</a>
</li><li class="has-sub"><a href="#Collecting-Events-from-Tests">Collecting Events from Tests</a>
</li><li class="has-sub"><a href="#Visualizing-Events-as-a-Table">Visualizing Events as a Table</a>
</li><li class="has-sub"><a href="#Visualizing-Suspicious-Code">Visualizing Suspicious Code</a>
</li><li class="has-sub"><a href="#Ranking-Events">Ranking Events</a>
</li><li class="has-sub"><a href="#Classes-and-Methods">Classes and Methods</a>
</ul></li><li class="has-sub"><a href="#Lessons-Learned"><i class="fa fa-fw fa-trophy"></i> Lessons Learned</a>
</li><li class="has-sub"><a href="#Next-Steps"><i class="fa fa-fw fa-arrows"></i> Next Steps</a>
</li><li class="has-sub"><a href="#Background"><i class="fa fa-fw fa-mortar-board"></i> Background</a>
</li><li class="has-sub"><a href="#Exercises"><i class="fa fa-fw fa-edit"></i> Exercises</a>
<ul><li class="has-sub"><a href="#Exercise-1:-A-Postcondition-for-Middle">Exercise 1: A Postcondition for Middle</a>
</li><li class="has-sub"><a href="#Exercise-2:-Statistical-Dependencies">Exercise 2: Statistical Dependencies</a>
</ul></li></ul></li>
     </li>
     
     <li class="has-sub"><a href="#"><span title="Resources"><i class="fa fa-fw fa-cube"></i> </span><span class="menu_3">Resources</span></a>
     <ul>
     <li><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?filepath=docs/beta/notebooks/StatisticalDebugger.ipynb" target="_blank" class="edit_as_notebook"><i class="fa fa-fw fa-edit"></i> Edit as Notebook</a></li>
     <li><a href="https://www.debuggingbook.org/beta/slides/StatisticalDebugger.slides.html" target="_blank"><i class="fa fa-fw fa-video-camera"></i> View Slides</a></li>
     <li><a href="https://www.debuggingbook.org/beta/code/StatisticalDebugger.py"><i class="fa fa-fw fa-download"></i> Download Code (.py)</a></li>
     <li><a href="https://www.debuggingbook.org/beta/notebooks/StatisticalDebugger.ipynb"><i class="fa fa-fw fa-download"></i> Download Notebook (.ipynb)</a></li>
     <li><a href="https://www.debuggingbook.org/beta/dist/debuggingbook-code.zip"><i class="fa fa-fw fa-cube"></i> All Code (.zip)</a></li>
     <li><a href="https://www.debuggingbook.org/beta/dist/debuggingbook-notebooks.zip"><i class="fa fa-fw fa-cube"></i> All Notebooks (.zip)</a></li>
     <li><a href="https://github.com/uds-se/debuggingbook/" target="_blank"><i class="fa fa-fw fa-github"></i> Project Page</a></li>
     <li><a href="ReleaseNotes.html" target="_blank"><i class="fa fa-fw fa-calendar"></i> Release Notes</a></li>
     </ul>
     </li>
     
     <li class="has-sub"><a href="#"><span title="Share"><i class="fa fa-fw fa-comments"></i> </span> <span class="menu_4">Share</span></a>
        <ul>
            <li><a href="https://twitter.com/intent/tweet?text=I%20just%20read%20%22Statistical%20Debugging%22%20(part%20of%20@Debugging_Book)%20at%20https%3a%2f%2fwww.debuggingbook.org%2fbeta%2fhtml%2fStatisticalDebugger.html" target="popup" 
onclick="window.open('https://twitter.com/intent/tweet?text=I%20just%20read%20%22Statistical%20Debugging%22%20(part%20of%20@Debugging_Book)%20at%20https%3a%2f%2fwww.debuggingbook.org%2fbeta%2fhtml%2fStatisticalDebugger.html','popup','width=600,height=600'); return false;"
><i class="fa fa-fw fa-twitter"></i> Share on Twitter</a>
            <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.debuggingbook.org%2fbeta%2fhtml%2fStatisticalDebugger.html" target="popup" 
onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.debuggingbook.org%2fbeta%2fhtml%2fStatisticalDebugger.html','popup','width=600,height=600'); return false;"
><i class="fa fa-fw fa-facebook"></i> Share on Facebook</a>
            <li><a href="mailto:?subject=Statistical%20Debugging&body=I%20just%20read%20%22Statistical%20Debugging%22%20(part%20of%20@Debugging_Book)%20at%20https%3a%2f%2fwww.debuggingbook.org%2fbeta%2fhtml%2fStatisticalDebugger.html"><i class="fa fa-fw fa-envelope"></i> Share by Email</a>
            <li><a href="#citation" id="cite" onclick="revealCitation()"><i class="fa fa-fw fa-mortar-board"></i> Cite</a>
        </ul>
     </li>
     <li class="has-sub"><a href="#"><span title="Help"><i class="fa fa-fw fa-question-circle"></i></span> <span class="menu_5">Help</span></a>
        <ul>
          <li><a href="https://www.debuggingbook.org/beta/#Troubleshooting"><i class="fa fa-fw fa-wrench"></i> Troubleshooting</a></li>
          <li><a href="https://docs.python.org/3/tutorial/" target=_blank><i class="fa fa-fw fa-question-circle"></i> Python Tutorial</a>
          <li><a href="https://www.dataquest.io/blog/jupyter-notebook-tutorial/" target=_blank><i class="fa fa-fw fa-question-circle"></i> Jupyter Notebook Tutorial</a>
          <li><a href="https://github.com/uds-se/debuggingbook/issues/" target="_blank"><i class="fa fa-fw fa-commenting"></i> Report an Issue</a></li>
        </ul>
     </li>
  </ul>
</div>
</nav>

    <article>
   <div tabindex="-1" id="notebook" class="border-box-sizing">
     <div class="container" id="notebook-container">

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Statistical-Debugging">Statistical Debugging<a class="anchor-link" href="#Statistical-Debugging">&#182;</a></h1><p><em class="beta"><i class="fa fa-fw fa-warning"></i>&nbsp;This chapter is still under review ("beta").  It may change at any time.</em></p><p>In this chapter, we introduce <em>statistical debugging</em> – the idea that specific events during execution could be <em>statistically correlated</em> with failures. We start with coverage of individual lines and then proceed towards further execution features.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook/tree/master/notebooks/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;UNuso00zYiI&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/UNuso00zYiI"
            frameborder="0"
            allowfullscreen
        ></iframe>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should have read the <a href="Tracer.html">chapter on tracing executions</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook/tree/master/notebooks/bookutils" class="import" target="_blank">bookutils</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="synopsis"><h2 id="Synopsis">Synopsis<a class="anchor-link" href="#Synopsis">&#182;</a></h2><!-- Automatically generated. Do not edit. -->

<p>To <a href="Importing.html">use the code provided in this chapter</a>, write</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn"><a href="StatisticalDebugger.html" class="import" target="_blank">debuggingbook.StatisticalDebugger</a></span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
<p>and then make use of the following features.</p>
<p>This chapter introduces classes and techniques for <em>statistical debugging</em> – that is, correlating specific events, such as lines covered, with passing and failing outcomes.</p>
<p>To make use of the code in this chapter, use one of the provided <code>StatisticalDebugger</code> subclasses such as <code>TarantulaDebugger</code> or <code>OchiaiDebugger</code>.</p>
<p>Both are instantiated with a <code>Collector</code> denoting the type of events you want to correlate outcomes with. The default <code>CoverageCollector</code>, collecting line coverage.</p>
<h3 id="Collecting-Events-from-Calls">Collecting Events from Calls<a class="anchor-link" href="#Collecting-Events-from-Calls">&#182;</a></h3><p>To collect events from calls that are labeled manually, use</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">debugger</span> <span class="o">=</span> <span class="n">TarantulaDebugger</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_fail</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
</pre></div>
<p>Within each <code>with</code> block, the <em>first function call</em> is collected and tracked for coverage. (Note that <em>only</em> the first call is tracked.)</p>
<h3 id="Collecting-Events-from-Tests">Collecting Events from Tests<a class="anchor-link" href="#Collecting-Events-from-Tests">&#182;</a></h3><p>To collect events from <em>tests</em> that use exceptions to indicate failure, use the simpler <code>with</code> form:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">debugger</span> <span class="o">=</span> <span class="n">TarantulaDebugger</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># raise an exception</span>
</pre></div>
<p><code>with</code> blocks that raise an exception will be classified as failing, blocks that do not will be classified as passing. Note that exceptions raised are "swallowed" by the debugger.</p>
<h3 id="Visualizing-Events-as-a-Table">Visualizing Events as a Table<a class="anchor-link" href="#Visualizing-Events-as-a-Table">&#182;</a></h3><p>After collecting events, you can print out the observed events – in this case, line numbers – in a table, showing in which runs they occurred (<code>X</code>), and with colors highlighting the suspiciousness of the event. A "red" event means that the event predominantly occurs in failing runs.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">debugger</span><span class="o">.</span><span class="n">event_table</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<table>
<thead><tr>
<th><code>remove_html_markup</code></th>
<th><code>s='abc'</code></th>
<th><code>s='&lt;b&gt;abc&lt;/b&gt;'</code></th>
<th><code>s='"abc"'</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:1</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:2</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:3</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:4</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:6</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:7</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%"> remove_html_markup:8</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:9</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">remove_html_markup:10</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:11</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(0.0, 100.0%, 80%)" title="100%">remove_html_markup:12</samp></td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:13</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:14</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:16</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<h3 id="Visualizing-Suspicious-Code">Visualizing Suspicious Code<a class="anchor-link" href="#Visualizing-Suspicious-Code">&#182;</a></h3><p>If you collected coverage with <code>CoverageCollector</code>, you can also visualize the code with similar colors, highlighting suspicious lines:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">debugger</span>
</pre></div>
<table>
<thead><tr>
<th><code>remove_html_markup</code></th>
<th><code>s='abc'</code></th>
<th><code>s='&lt;b&gt;abc&lt;/b&gt;'</code></th>
<th><code>s='"abc"'</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:1</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:2</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:3</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:4</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:6</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:7</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%"> remove_html_markup:8</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%"> remove_html_markup:9</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">remove_html_markup:10</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:11</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(0.0, 100.0%, 80%)" title="100%">remove_html_markup:12</samp></td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:13</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:14</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">remove_html_markup:16</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<h3 id="Ranking-Events">Ranking Events<a class="anchor-link" href="#Ranking-Events">&#182;</a></h3><p>The method <code>rank()</code> returns a ranked list of events, starting with the most suspicious. This is useful for automated techniques that need potential defect locations.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">debugger</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>

<span class="p">[(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;remove_html_markup&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
</pre></div>
<h3 id="Classes-and-Methods">Classes and Methods<a class="anchor-link" href="#Classes-and-Methods">&#182;</a></h3><p>Here are all classes defined in this chapter:</p>
<p><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="509pt" height="826pt"
 viewBox="0.00 0.00 508.50 826.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 822)">
<title>%3</title>
<g id="a_graph0"><a xlink:title="TarantulaDebugger class hierarchy">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-822 504.5,-822 504.5,4 -4,4"/>
</a>
</g>
<!-- TarantulaDebugger -->
<g id="node1" class="node">
<title>TarantulaDebugger</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class TarantulaDebugger:&#10;Spectrum&#45;based Debugger using the Tarantula metric for suspiciousness">
<polygon fill="none" stroke="#000000" points="60,-9 60,-45 209,-45 209,-9 60,-9"/>
<text text-anchor="start" x="68" y="-24.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">TarantulaDebugger</text>
</a>
</g>
</g>
<!-- ContinuousSpectrumDebugger -->
<g id="node2" class="node">
<title>ContinuousSpectrumDebugger</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class ContinuousSpectrumDebugger:&#10;Visualize differences between executions using a color spectrum">
<polygon fill="none" stroke="#000000" points="0,-90.5 0,-231.5 227,-231.5 227,-90.5 0,-90.5"/>
<text text-anchor="start" x="8" y="-217.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">ContinuousSpectrumDebugger</text>
<polyline fill="none" stroke="#000000" points="0,-208.5 227,-208.5 "/>
<g id="a_node2_0"><a xlink:href="#" xlink:title="ContinuousSpectrumDebugger">
<g id="a_node2_1"><a xlink:href="#" xlink:title="brightness(self, event:Any) &#45;&gt; float">
<text text-anchor="start" x="35.5" y="-196.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">brightness()</text>
</a>
</g>
<g id="a_node2_2"><a xlink:href="#" xlink:title="collectors_with_event(self, event:Any, category:str) &#45;&gt; Set[__main__.Collector]:&#10;Return all collectors in a category&#10;that observed the given event.">
<text text-anchor="start" x="35.5" y="-185.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">collectors_with_event()</text>
</a>
</g>
<g id="a_node2_3"><a xlink:href="#" xlink:title="collectors_without_event(self, event:Any, category:str) &#45;&gt; Set[__main__.Collector]:&#10;Return all collectors in a category&#10;that did not observe the given event.">
<text text-anchor="start" x="35.5" y="-174.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">collectors_without_event()</text>
</a>
</g>
<g id="a_node2_4"><a xlink:href="#" xlink:title="color(self, event:Any) &#45;&gt; Union[str, NoneType]:&#10;Return a color for the given event.">
<text text-anchor="start" x="35.5" y="-164.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">color()</text>
</a>
</g>
<g id="a_node2_5"><a xlink:href="#" xlink:title="event_fraction(self, event:Any, category:str) &#45;&gt; float">
<text text-anchor="start" x="35.5" y="-152.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">event_fraction()</text>
</a>
</g>
<g id="a_node2_6"><a xlink:href="#" xlink:title="failed_fraction(self, event:Any) &#45;&gt; float">
<text text-anchor="start" x="35.5" y="-141.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">failed_fraction()</text>
</a>
</g>
<g id="a_node2_7"><a xlink:href="#" xlink:title="hue(self, event:Any) &#45;&gt; Union[float, NoneType]:&#10;Return a color hue from 0.0 (red) to 1.0 (green).">
<text text-anchor="start" x="35.5" y="-130.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">hue()</text>
</a>
</g>
<g id="a_node2_8"><a xlink:href="#" xlink:title="passed_fraction(self, event:Any) &#45;&gt; float">
<text text-anchor="start" x="35.5" y="-119.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">passed_fraction()</text>
</a>
</g>
<g id="a_node2_9"><a xlink:href="#" xlink:title="suspiciousness(self, event:Any) &#45;&gt; Union[float, NoneType]:&#10;Return a suspiciousness value [0, 1.0]&#10;for the given event, or `None` if unknown">
<text text-anchor="start" x="35.5" y="-109.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">suspiciousness()</text>
</a>
</g>
<g id="a_node2_10"><a xlink:href="#" xlink:title="tooltip(self, event:Any) &#45;&gt; str:&#10;Return a tooltip for the given event.">
<text text-anchor="start" x="35.5" y="-98.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">tooltip()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- TarantulaDebugger&#45;&gt;ContinuousSpectrumDebugger -->
<g id="edge1" class="edge">
<title>TarantulaDebugger&#45;&gt;ContinuousSpectrumDebugger</title>
<path fill="none" stroke="#000000" d="M131.6678,-45.0718C130.178,-54.5787 128.2352,-66.9753 126.1756,-80.1173"/>
<polygon fill="none" stroke="#000000" points="122.674,-79.8555 124.5835,-90.2768 129.5896,-80.9393 122.674,-79.8555"/>
</g>
<!-- RankingDebugger -->
<g id="node6" class="node">
<title>RankingDebugger</title>
<g id="a_node6"><a xlink:href="#" xlink:title="class RankingDebugger:&#10;Rank events by their suspiciousness">
<polygon fill="none" stroke="#000000" points="245,-134.5 245,-187.5 380,-187.5 380,-134.5 245,-134.5"/>
<text text-anchor="start" x="253" y="-173.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-style="italic" font-size="14.00" fill="#6a0dad">RankingDebugger</text>
<polyline fill="none" stroke="#000000" points="245,-164.5 380,-164.5 "/>
<g id="a_node6_11"><a xlink:href="#" xlink:title="RankingDebugger">
<g id="a_node6_12"><a xlink:href="#" xlink:title="rank(self) &#45;&gt; List[Any]:&#10;Return a list of events, sorted by suspiciousness, highest first.">
<text text-anchor="start" x="282.5" y="-153.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">rank()</text>
</a>
</g>
<g id="a_node6_13"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Show code as string">
<text text-anchor="start" x="282.5" y="-142.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">__repr__()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- TarantulaDebugger&#45;&gt;RankingDebugger -->
<g id="edge5" class="edge">
<title>TarantulaDebugger&#45;&gt;RankingDebugger</title>
<path fill="none" stroke="#000000" d="M167.2784,-45.0172C187.8301,-56.8473 214.5019,-73.1954 236.5,-90 251.2534,-101.2703 266.4157,-114.9408 279.2784,-127.2654"/>
<polygon fill="none" stroke="#000000" points="276.952,-129.8849 286.5656,-134.3381 281.8273,-124.8618 276.952,-129.8849"/>
</g>
<!-- DiscreteSpectrumDebugger -->
<g id="node3" class="node">
<title>DiscreteSpectrumDebugger</title>
<g id="a_node3"><a xlink:href="#" xlink:title="class DiscreteSpectrumDebugger:&#10;Visualize differences between executions using three discrete colors">
<polygon fill="none" stroke="#000000" points="109.5,-268.5 109.5,-387.5 315.5,-387.5 315.5,-268.5 109.5,-268.5"/>
<text text-anchor="start" x="117.5" y="-373.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">DiscreteSpectrumDebugger</text>
<polyline fill="none" stroke="#000000" points="109.5,-364.5 315.5,-364.5 "/>
<g id="a_node3_14"><a xlink:href="#" xlink:title="DiscreteSpectrumDebugger">
<g id="a_node3_15"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Show code as string">
<text text-anchor="start" x="164.5" y="-353.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">__repr__()</text>
</a>
</g>
<g id="a_node3_16"><a xlink:href="#" xlink:title="_repr_html_(self) &#45;&gt; str:&#10;When output in Jupyter, visualize as HTML">
<text text-anchor="start" x="164.5" y="-342.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">_repr_html_()</text>
</a>
</g>
<g id="a_node3_17"><a xlink:href="#" xlink:title="code(self, functions:Union[Set[Callable], NoneType]=None, *, color:bool=False, suspiciousness:bool=False, line_numbers:bool=True) &#45;&gt; str:&#10;Return a listing of `functions` (default: covered functions).&#10;If `color` is True, render as HTML, using suspiciousness colors.&#10;If `suspiciousness` is True, include suspiciousness values.&#10;If `line_numbers` is True (default), include line numbers.">
<text text-anchor="start" x="164.5" y="-331.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">code()</text>
</a>
</g>
<g id="a_node3_18"><a xlink:href="#" xlink:title="__str__(self) &#45;&gt; str:&#10;Show code as string">
<text text-anchor="start" x="164.5" y="-319.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">__str__()</text>
</a>
</g>
<g id="a_node3_19"><a xlink:href="#" xlink:title="color(self, event:Any) &#45;&gt; Union[str, NoneType]:&#10;Return a color for the given event.">
<text text-anchor="start" x="164.5" y="-309.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">color()</text>
</a>
</g>
<g id="a_node3_20"><a xlink:href="#" xlink:title="percentage(self, event:Any) &#45;&gt; str:&#10;Return the suspiciousness for the given event as percentage string">
<text text-anchor="start" x="164.5" y="-297.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">percentage()</text>
</a>
</g>
<g id="a_node3_21"><a xlink:href="#" xlink:title="suspiciousness(self, event:Any) &#45;&gt; Union[float, NoneType]:&#10;Return a suspiciousness value [0, 1.0]&#10;for the given event, or `None` if unknown">
<text text-anchor="start" x="164.5" y="-287.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">suspiciousness()</text>
</a>
</g>
<g id="a_node3_22"><a xlink:href="#" xlink:title="tooltip(self, event:Any) &#45;&gt; str:&#10;Return a tooltip for the given event.">
<text text-anchor="start" x="164.5" y="-276.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">tooltip()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- ContinuousSpectrumDebugger&#45;&gt;DiscreteSpectrumDebugger -->
<g id="edge2" class="edge">
<title>ContinuousSpectrumDebugger&#45;&gt;DiscreteSpectrumDebugger</title>
<path fill="none" stroke="#000000" d="M155.4849,-231.823C160.9563,-241.0525 166.553,-250.4935 171.9994,-259.6807"/>
<polygon fill="none" stroke="#000000" points="169.0558,-261.5789 177.166,-268.3962 175.0773,-258.0093 169.0558,-261.5789"/>
</g>
<!-- DifferenceDebugger -->
<g id="node4" class="node">
<title>DifferenceDebugger</title>
<g id="a_node4"><a xlink:href="#" xlink:title="class DifferenceDebugger:&#10;A class to collect events for passing and failing outcomes.">
<polygon fill="none" stroke="#000000" points="139,-424.5 139,-595.5 286,-595.5 286,-424.5 139,-424.5"/>
<text text-anchor="start" x="147" y="-581.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-style="italic" font-size="14.00" fill="#6a0dad">DifferenceDebugger</text>
<polyline fill="none" stroke="#000000" points="139,-572.5 286,-572.5 "/>
<g id="a_node4_23"><a xlink:href="#" xlink:title="DifferenceDebugger">
<g id="a_node4_24"><a xlink:href="#" xlink:title="FAIL = &#39;FAIL&#39;">
<text text-anchor="start" x="200.5" y="-560.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">FAIL</text>
</a>
</g>
<g id="a_node4_25"><a xlink:href="#" xlink:title="PASS = &#39;PASS&#39;">
<text text-anchor="start" x="200.5" y="-549.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">PASS</text>
</a>
</g>
</a>
</g>
<polyline fill="none" stroke="#000000" points="139,-542.5 286,-542.5 "/>
<g id="a_node4_26"><a xlink:href="#" xlink:title="DifferenceDebugger">
<g id="a_node4_27"><a xlink:href="#" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Enter a `with` block. Collect coverage and outcome;&#10;classify as FAIL if the block raises an exception,&#10;and PASS if it does not.">
<text text-anchor="start" x="158.5" y="-531.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">__enter__()</text>
</a>
</g>
<g id="a_node4_28"><a xlink:href="#" xlink:title="__exit__(self, exc_tp:Type, exc_value:BaseException, exc_traceback:traceback) &#45;&gt; Union[bool, NoneType]:&#10;Exit the `with` block.">
<text text-anchor="start" x="158.5" y="-520.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">__exit__()</text>
</a>
</g>
<g id="a_node4_29"><a xlink:href="#" xlink:title="all_fail_events(self) &#45;&gt; Set[Any]:&#10;Return all events observed in failing runs.">
<text text-anchor="start" x="158.5" y="-509.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">all_fail_events()</text>
</a>
</g>
<g id="a_node4_30"><a xlink:href="#" xlink:title="all_pass_events(self) &#45;&gt; Set[Any]:&#10;Return all events observed in passing runs.">
<text text-anchor="start" x="158.5" y="-498.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">all_pass_events()</text>
</a>
</g>
<g id="a_node4_31"><a xlink:href="#" xlink:title="collect_fail(self, *args:Any, **kwargs:Any) &#45;&gt; __main__.Collector:&#10;Return a collector for failing runs.">
<text text-anchor="start" x="158.5" y="-487.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">collect_fail()</text>
</a>
</g>
<g id="a_node4_32"><a xlink:href="#" xlink:title="collect_pass(self, *args:Any, **kwargs:Any) &#45;&gt; __main__.Collector:&#10;Return a collector for passing runs.">
<text text-anchor="start" x="158.5" y="-476.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">collect_pass()</text>
</a>
</g>
<g id="a_node4_33"><a xlink:href="#" xlink:title="only_fail_events(self) &#45;&gt; Set[Any]:&#10;Return all events observed only in failing runs.">
<text text-anchor="start" x="158.5" y="-465.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">only_fail_events()</text>
</a>
</g>
<g id="a_node4_34"><a xlink:href="#" xlink:title="only_pass_events(self) &#45;&gt; Set[Any]:&#10;Return all events observed only in passing runs.">
<text text-anchor="start" x="158.5" y="-454.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">only_pass_events()</text>
</a>
</g>
<g id="a_node4_35"><a xlink:href="#" xlink:title="fail_collectors(self) &#45;&gt; List[__main__.Collector]">
<text text-anchor="start" x="158.5" y="-442.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">fail_collectors()</text>
</a>
</g>
<g id="a_node4_36"><a xlink:href="#" xlink:title="pass_collectors(self) &#45;&gt; List[__main__.Collector]">
<text text-anchor="start" x="158.5" y="-431.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">pass_collectors()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DiscreteSpectrumDebugger&#45;&gt;DifferenceDebugger -->
<g id="edge3" class="edge">
<title>DiscreteSpectrumDebugger&#45;&gt;DifferenceDebugger</title>
<path fill="none" stroke="#000000" d="M212.5,-387.5936C212.5,-396.1051 212.5,-405.0343 212.5,-414.0285"/>
<polygon fill="none" stroke="#000000" points="209.0001,-414.192 212.5,-424.1921 216.0001,-414.1921 209.0001,-414.192"/>
</g>
<!-- StatisticalDebugger -->
<g id="node5" class="node">
<title>StatisticalDebugger</title>
<g id="a_node5"><a xlink:href="#" xlink:title="class StatisticalDebugger:&#10;A class to collect events for multiple outcomes.">
<polygon fill="none" stroke="#000000" points="138.5,-632.5 138.5,-817.5 286.5,-817.5 286.5,-632.5 138.5,-632.5"/>
<text text-anchor="start" x="146.5" y="-803.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-style="italic" font-size="14.00" fill="#6a0dad">StatisticalDebugger</text>
<polyline fill="none" stroke="#000000" points="138.5,-794.5 286.5,-794.5 "/>
<g id="a_node5_37"><a xlink:href="#" xlink:title="StatisticalDebugger">
<g id="a_node5_38"><a xlink:href="#" xlink:title="__init__(self, collector_class:Type=&lt;class &#39;__main__.CoverageCollector&#39;&gt;, log:bool=False):&#10;Constructor. Use instances of `collector_class` to collect events.">
<text text-anchor="start" x="155.5" y="-783.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">__init__()</text>
</a>
</g>
<g id="a_node5_39"><a xlink:href="#" xlink:title="all_events(self, outcome:Union[str, NoneType]=None) &#45;&gt; Set[Any]:&#10;Return a set of all events observed.">
<text text-anchor="start" x="155.5" y="-772.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">all_events()</text>
</a>
</g>
<g id="a_node5_40"><a xlink:href="#" xlink:title="coverage(self) &#45;&gt; Set[Tuple[Callable, int]]:&#10;Return a set of all (functions, line_numbers) observed">
<text text-anchor="start" x="155.5" y="-761.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">coverage()</text>
</a>
</g>
<g id="a_node5_41"><a xlink:href="#" xlink:title="covered_functions(self) &#45;&gt; Set[Callable]:&#10;Return a set of all functions observed.">
<text text-anchor="start" x="155.5" y="-750.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">covered_functions()</text>
</a>
</g>
<g id="a_node5_42"><a xlink:href="#" xlink:title="event_table(self, **_args:Any) &#45;&gt; Any:&#10;Print out event table in Markdown format.">
<text text-anchor="start" x="155.5" y="-739.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">event_table()</text>
</a>
</g>
<g id="a_node5_43"><a xlink:href="#" xlink:title="function(self) &#45;&gt; Union[Callable, NoneType]:&#10;Return the entry function from the events observed,&#10;or None if ambiguous.">
<text text-anchor="start" x="155.5" y="-728.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">function()</text>
</a>
</g>
<g id="a_node5_44"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Return repr(self).">
<text text-anchor="start" x="155.5" y="-717.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">__repr__()</text>
</a>
</g>
<g id="a_node5_45"><a xlink:href="#" xlink:title="_repr_markdown_(self) &#45;&gt; str">
<text text-anchor="start" x="155.5" y="-705.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">_repr_markdown_()</text>
</a>
</g>
<g id="a_node5_46"><a xlink:href="#" xlink:title="add_collector(self, outcome:str, collector:__main__.Collector) &#45;&gt; __main__.Collector">
<text text-anchor="start" x="155.5" y="-694.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">add_collector()</text>
</a>
</g>
<g id="a_node5_47"><a xlink:href="#" xlink:title="collect(self, outcome:str, *args:Any, **kwargs:Any) &#45;&gt; __main__.Collector:&#10;Return a collector for the given outcome.&#10;Additional args are passed to the collector.">
<text text-anchor="start" x="155.5" y="-683.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">collect()</text>
</a>
</g>
<g id="a_node5_48"><a xlink:href="#" xlink:title="color(self, event:Any) &#45;&gt; Union[str, NoneType]:&#10;Return a color for the given event, or None.&#10;To be overloaded in subclasses.">
<text text-anchor="start" x="155.5" y="-673.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">color()</text>
</a>
</g>
<g id="a_node5_49"><a xlink:href="#" xlink:title="event_str(self, event:Any) &#45;&gt; str:&#10;Format the given event. To be overloaded in subclasses.">
<text text-anchor="start" x="155.5" y="-662.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">event_str()</text>
</a>
</g>
<g id="a_node5_50"><a xlink:href="#" xlink:title="event_table_text(self, *, args:bool=False, color:bool=False) &#45;&gt; str:&#10;Print out a table of events observed.&#10;If `args` is True, use arguments as headers.&#10;If `color` is True, use colors.">
<text text-anchor="start" x="155.5" y="-650.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">event_table_text()</text>
</a>
</g>
<g id="a_node5_51"><a xlink:href="#" xlink:title="tooltip(self, event:Any) &#45;&gt; Union[str, NoneType]:&#10;Return a tooltip string for the given event, or None.&#10;To be overloaded in subclasses.">
<text text-anchor="start" x="155.5" y="-640.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">tooltip()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DifferenceDebugger&#45;&gt;StatisticalDebugger -->
<g id="edge4" class="edge">
<title>DifferenceDebugger&#45;&gt;StatisticalDebugger</title>
<path fill="none" stroke="#000000" d="M212.5,-595.5915C212.5,-604.355 212.5,-613.3213 212.5,-622.244"/>
<polygon fill="none" stroke="#000000" points="209.0001,-622.2863 212.5,-632.2863 216.0001,-622.2863 209.0001,-622.2863"/>
</g>
<!-- RankingDebugger&#45;&gt;DiscreteSpectrumDebugger -->
<g id="edge6" class="edge">
<title>RankingDebugger&#45;&gt;DiscreteSpectrumDebugger</title>
<path fill="none" stroke="#000000" d="M296.4333,-187.8314C284.8272,-207.2135 268.6027,-234.3085 253.5086,-259.5157"/>
<polygon fill="none" stroke="#000000" points="250.3608,-257.9597 248.2262,-268.3373 256.3664,-261.556 250.3608,-257.9597"/>
</g>
<!-- OchiaiDebugger -->
<g id="node7" class="node">
<title>OchiaiDebugger</title>
<g id="a_node7"><a xlink:href="#" xlink:title="class OchiaiDebugger:&#10;Spectrum&#45;based Debugger using the Ochiai metric for suspiciousness">
<polygon fill="none" stroke="#000000" points="238.5,-.5 238.5,-53.5 364.5,-53.5 364.5,-.5 238.5,-.5"/>
<text text-anchor="start" x="246.5" y="-39.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">OchiaiDebugger</text>
<polyline fill="none" stroke="#000000" points="238.5,-30.5 364.5,-30.5 "/>
<g id="a_node7_52"><a xlink:href="#" xlink:title="OchiaiDebugger">
<g id="a_node7_53"><a xlink:href="#" xlink:title="hue(self, event:Any) &#45;&gt; Union[float, NoneType]:&#10;Return a color hue from 0.0 (red) to 1.0 (green).">
<text text-anchor="start" x="253.5" y="-19.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">hue()</text>
</a>
</g>
<g id="a_node7_54"><a xlink:href="#" xlink:title="suspiciousness(self, event:Any) &#45;&gt; Union[float, NoneType]:&#10;Return a suspiciousness value [0, 1.0]&#10;for the given event, or `None` if unknown">
<text text-anchor="start" x="253.5" y="-8.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">suspiciousness()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- OchiaiDebugger&#45;&gt;ContinuousSpectrumDebugger -->
<g id="edge7" class="edge">
<title>OchiaiDebugger&#45;&gt;ContinuousSpectrumDebugger</title>
<path fill="none" stroke="#000000" d="M263.9072,-53.7948C251.2496,-62.8168 236.4266,-73.3821 221.1111,-84.2985"/>
<polygon fill="none" stroke="#000000" points="218.6742,-81.7373 212.5624,-90.3917 222.7371,-87.4376 218.6742,-81.7373"/>
</g>
<!-- OchiaiDebugger&#45;&gt;RankingDebugger -->
<g id="edge8" class="edge">
<title>OchiaiDebugger&#45;&gt;RankingDebugger</title>
<path fill="none" stroke="#000000" d="M303.6996,-53.7948C305.3558,-73.9707 307.6457,-101.8652 309.4744,-124.1428"/>
<polygon fill="none" stroke="#000000" points="305.9977,-124.5715 310.3042,-134.2516 312.9743,-123.9987 305.9977,-124.5715"/>
</g>
<!-- Legend -->
<g id="node8" class="node">
<title>Legend</title>
<text text-anchor="start" x="382.5" y="-44.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text text-anchor="start" x="382.5" y="-34.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="389.5" y="-34.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00" fill="#000000">public_method()</text>
<text text-anchor="start" x="382.5" y="-24.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="389.5" y="-24.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00" fill="#000000">private_method()</text>
<text text-anchor="start" x="382.5" y="-14.5" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="389.5" y="-14.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00" fill="#000000">overloaded_method()</text>
<text text-anchor="start" x="382.5" y="-5.3" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#000000">Hover over names to see doc</text>
</g>
</g>
</svg>
</p>
<p><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="424pt" height="681pt"
 viewBox="0.00 0.00 424.00 681.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 677)">
<title>%3</title>
<g id="a_graph0"><a xlink:title="CoverageCollector class hierarchy">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-677 420,-677 420,4 -4,4"/>
</a>
</g>
<!-- CoverageCollector -->
<g id="node1" class="node">
<title>CoverageCollector</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class CoverageCollector:&#10;A class to record covered locations during execution.">
<polygon fill="none" stroke="#000000" points="136,-.5 136,-86.5 280,-86.5 280,-.5 136,-.5"/>
<text text-anchor="start" x="144" y="-72.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">CoverageCollector</text>
<polyline fill="none" stroke="#000000" points="136,-63.5 280,-63.5 "/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="CoverageCollector">
<g id="a_node1_1"><a xlink:href="#" xlink:title="coverage(self) &#45;&gt; Set[Tuple[Callable, int]]:&#10;Return a set (function, lineno) with all locations covered.">
<text text-anchor="start" x="151" y="-52" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">coverage()</text>
</a>
</g>
<g id="a_node1_2"><a xlink:href="#" xlink:title="covered_functions(self) &#45;&gt; Set[Callable]:&#10;Return a set with all functions covered.">
<text text-anchor="start" x="151" y="-41" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">covered_functions()</text>
</a>
</g>
<g id="a_node1_3"><a xlink:href="#" xlink:title="events(self) &#45;&gt; Set[Tuple[str, int]]:&#10;Return the set of locations covered.&#10;Each location comes as a pair (`function_name`, `lineno`).">
<text text-anchor="start" x="151" y="-30" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">events()</text>
</a>
</g>
<g id="a_node1_4"><a xlink:href="#" xlink:title="__init__(self) &#45;&gt; None:&#10;Constructor.">
<text text-anchor="start" x="151" y="-19" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">__init__()</text>
</a>
</g>
<g id="a_node1_5"><a xlink:href="#" xlink:title="collect(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Save coverage for an observed event.">
<text text-anchor="start" x="151" y="-8" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">collect()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- Collector -->
<g id="node2" class="node">
<title>Collector</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class Collector:&#10;A class to record events during execution.">
<polygon fill="none" stroke="#000000" points="24.5,-123.5 24.5,-308.5 179.5,-308.5 179.5,-123.5 24.5,-123.5"/>
<text text-anchor="start" x="70.5" y="-294.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">Collector</text>
<polyline fill="none" stroke="#000000" points="24.5,-285.5 179.5,-285.5 "/>
<g id="a_node2_6"><a xlink:href="#" xlink:title="Collector">
<g id="a_node2_7"><a xlink:href="#" xlink:title="__init__(self) &#45;&gt; None:&#10;Constructor.">
<text text-anchor="start" x="33" y="-274.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">__init__()</text>
</a>
</g>
<g id="a_node2_8"><a xlink:href="#" xlink:title="__repr__(self) &#45;&gt; str:&#10;Return a string representation of the collector">
<text text-anchor="start" x="33" y="-263.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">__repr__()</text>
</a>
</g>
<g id="a_node2_9"><a xlink:href="#" xlink:title="args(self) &#45;&gt; Dict[str, Any]:&#10;Return a dict of argument names and values from the first call">
<text text-anchor="start" x="33" y="-252.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">args()</text>
</a>
</g>
<g id="a_node2_10"><a xlink:href="#" xlink:title="argstring(self) &#45;&gt; str:&#10;Return the list of arguments from the first call, as a printable string">
<text text-anchor="start" x="33" y="-241.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">argstring()</text>
</a>
</g>
<g id="a_node2_11"><a xlink:href="#" xlink:title="collect(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Collector function. To be overloaded in subclasses.">
<text text-anchor="start" x="33" y="-230.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">collect()</text>
</a>
</g>
<g id="a_node2_12"><a xlink:href="#" xlink:title="exception(self) &#45;&gt; Union[Type, NoneType]:&#10;Return the exception class from the first call,&#10;or None if no exception was raised.">
<text text-anchor="start" x="33" y="-219.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">exception()</text>
</a>
</g>
<g id="a_node2_13"><a xlink:href="#" xlink:title="function(self) &#45;&gt; Callable:&#10;Return the function from the first call, as a function object">
<text text-anchor="start" x="33" y="-208.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">function()</text>
</a>
</g>
<g id="a_node2_14"><a xlink:href="#" xlink:title="id(self) &#45;&gt; str:&#10;Return an identifier for the collector,&#10;created from the first call">
<text text-anchor="start" x="33" y="-197.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">id()</text>
</a>
</g>
<g id="a_node2_15"><a xlink:href="#" xlink:title="__exit__(self, exc_tp:Type, exc_value:BaseException, exc_traceback:traceback) &#45;&gt; Union[bool, NoneType]:&#10;Exit the `with` block.">
<text text-anchor="start" x="33" y="-186.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">__exit__()</text>
</a>
</g>
<g id="a_node2_16"><a xlink:href="#" xlink:title="add_classes_to_ignore(self, classes_to_ignore:List[Type]) &#45;&gt; None:&#10;Define additional classes to ignore during collection&#10;(typically `Debugger` classes using these collectors).">
<text text-anchor="start" x="33" y="-174.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">add_classes_to_ignore()</text>
</a>
</g>
<g id="a_node2_17"><a xlink:href="#" xlink:title="coverage(self) &#45;&gt; Set[Tuple[Callable, int]]:&#10;Return a set (function, lineno) with locations covered.&#10;To be overloaded in subclasses.">
<text text-anchor="start" x="33" y="-164.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">coverage()</text>
</a>
</g>
<g id="a_node2_18"><a xlink:href="#" xlink:title="covered_functions(self) &#45;&gt; Set[Callable]:&#10;Set of covered functions. To be overloaded in subclasses.">
<text text-anchor="start" x="33" y="-153.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">covered_functions()</text>
</a>
</g>
<g id="a_node2_19"><a xlink:href="#" xlink:title="events(self) &#45;&gt; Set:&#10;Return a collection of events. To be overridden in subclasses.">
<text text-anchor="start" x="33" y="-142.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">events()</text>
</a>
</g>
<g id="a_node2_20"><a xlink:href="#" xlink:title="traceit(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Tracing function. Saves the first function and calls collect().">
<text text-anchor="start" x="33" y="-131.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">traceit()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CoverageCollector&#45;&gt;Collector -->
<g id="edge1" class="edge">
<title>CoverageCollector&#45;&gt;Collector</title>
<path fill="none" stroke="#000000" d="M181.5252,-86.5841C176.1658,-95.3057 170.3188,-104.8207 164.307,-114.6042"/>
<polygon fill="none" stroke="#000000" points="161.243,-112.9053 158.9895,-123.2577 167.207,-116.5701 161.243,-112.9053"/>
</g>
<!-- StackInspector -->
<g id="node4" class="node">
<title>StackInspector</title>
<g id="a_node4"><a xlink:href="StackInspector.html" xlink:title="class StackInspector:&#10;Provide functions to inspect the stack">
<polygon fill="none" stroke="#000000" points="71.5,-501.5 71.5,-672.5 238.5,-672.5 238.5,-501.5 71.5,-501.5"/>
<text text-anchor="start" x="104" y="-658.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">StackInspector</text>
<polyline fill="none" stroke="#000000" points="71.5,-649.5 238.5,-649.5 "/>
<g id="a_node4_21"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node4_22"><a xlink:href="StackInspector.html" xlink:title="_generated_function_cache = {(&#39;remove_html_markup&#39;, 1): &lt;function remove_html_markup at 0x7f8728ea4d90&gt;, (&#39;middle&#39;, 1): &lt;function middle at 0x7f8729504598&gt;}">
<text text-anchor="start" x="80" y="-637" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">_generated_function_cache</text>
</a>
</g>
</a>
</g>
<polyline fill="none" stroke="#000000" points="71.5,-630.5 238.5,-630.5 "/>
<g id="a_node4_23"><a xlink:href="#" xlink:title="StackInspector">
<g id="a_node4_24"><a xlink:href="StackInspector.html" xlink:title="caller_frame(self) &#45;&gt; frame:&#10;Return the frame of the caller.">
<text text-anchor="start" x="98" y="-618" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">caller_frame()</text>
</a>
</g>
<g id="a_node4_25"><a xlink:href="StackInspector.html" xlink:title="caller_function(self) &#45;&gt; Callable:&#10;Return the calling function">
<text text-anchor="start" x="98" y="-607" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">caller_function()</text>
</a>
</g>
<g id="a_node4_26"><a xlink:href="StackInspector.html" xlink:title="caller_globals(self) &#45;&gt; Dict[str, Any]:&#10;Return the globals() environment of the caller.">
<text text-anchor="start" x="98" y="-596" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">caller_globals()</text>
</a>
</g>
<g id="a_node4_27"><a xlink:href="StackInspector.html" xlink:title="caller_locals(self) &#45;&gt; Dict[str, Any]:&#10;Return the locals() environment of the caller.">
<text text-anchor="start" x="98" y="-585" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">caller_locals()</text>
</a>
</g>
<g id="a_node4_28"><a xlink:href="StackInspector.html" xlink:title="caller_location(self) &#45;&gt; Tuple[Callable, int]:&#10;Return the location (func, lineno) of the caller.">
<text text-anchor="start" x="98" y="-574" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">caller_location()</text>
</a>
</g>
<g id="a_node4_29"><a xlink:href="StackInspector.html" xlink:title="create_function(self, frame:frame) &#45;&gt; Callable:&#10;Create function for given frame">
<text text-anchor="start" x="98" y="-563" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">create_function()</text>
</a>
</g>
<g id="a_node4_30"><a xlink:href="StackInspector.html" xlink:title="is_internal_error(self, exc_tp:Type, exc_value:BaseException, exc_traceback:traceback) &#45;&gt; bool:&#10;Return True if exception was raised from `StackInspector` or a subclass.">
<text text-anchor="start" x="98" y="-552" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">is_internal_error()</text>
</a>
</g>
<g id="a_node4_31"><a xlink:href="StackInspector.html" xlink:title="our_frame(self, frame:frame) &#45;&gt; bool:&#10;Return true if `frame` is in the current (inspecting) class.">
<text text-anchor="start" x="98" y="-541" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">our_frame()</text>
</a>
</g>
<g id="a_node4_32"><a xlink:href="StackInspector.html" xlink:title="search_frame(self, name:str, frame:Union[frame, NoneType]=None) &#45;&gt; Tuple[Union[frame, NoneType], Union[Callable, NoneType]]:&#10;Return a pair (`frame`, `item`)&#10;in which the function `name` is defined as `item`.">
<text text-anchor="start" x="98" y="-530" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">search_frame()</text>
</a>
</g>
<g id="a_node4_33"><a xlink:href="StackInspector.html" xlink:title="search_func(self, name:str, frame:Union[frame, NoneType]=None) &#45;&gt; Union[Callable, NoneType]:&#10;Search in callers for a definition of the function `name`">
<text text-anchor="start" x="98" y="-519" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">search_func()</text>
</a>
</g>
<g id="a_node4_34"><a xlink:href="StackInspector.html" xlink:title="unknown(self) &#45;&gt; None">
<text text-anchor="start" x="98" y="-508" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">unknown()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CoverageCollector&#45;&gt;StackInspector -->
<g id="edge4" class="edge">
<title>CoverageCollector&#45;&gt;StackInspector</title>
<path fill="none" stroke="#000000" d="M209.2589,-86.6046C210.7882,-163.2621 210.8697,-328.1077 189,-465 187.6265,-473.5976 185.8644,-482.4543 183.8668,-491.2844"/>
<polygon fill="none" stroke="#000000" points="180.4109,-490.6906 181.5196,-501.2273 187.2236,-492.2989 180.4109,-490.6906"/>
</g>
<!-- Tracer -->
<g id="node3" class="node">
<title>Tracer</title>
<g id="a_node3"><a xlink:href="Tracer.html" xlink:title="class Tracer:&#10;A class for tracing a piece of code. Use as `with Tracer(): block()`">
<polygon fill="none" stroke="#000000" points="24.5,-345.5 24.5,-464.5 179.5,-464.5 179.5,-345.5 24.5,-345.5"/>
<text text-anchor="start" x="80" y="-450.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">Tracer</text>
<polyline fill="none" stroke="#000000" points="24.5,-441.5 179.5,-441.5 "/>
<g id="a_node3_35"><a xlink:href="#" xlink:title="Tracer">
<g id="a_node3_36"><a xlink:href="Tracer.html" xlink:title="__enter__(self) &#45;&gt; Any:&#10;Called at begin of `with` block. Turn tracing on.">
<text text-anchor="start" x="33" y="-430.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">__enter__()</text>
</a>
</g>
<g id="a_node3_37"><a xlink:href="Tracer.html" xlink:title="__exit__(self, exc_tp:Type, exc_value:BaseException, exc_traceback:traceback) &#45;&gt; Union[bool, NoneType]:&#10;Called at end of `with` block. Turn tracing off.&#10;Return `None` if ok, not `None` if internal error.">
<text text-anchor="start" x="33" y="-419.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">__exit__()</text>
</a>
</g>
<g id="a_node3_38"><a xlink:href="Tracer.html" xlink:title="__init__(self, file:TextIO=&lt;ipykernel.iostream.OutStream object at 0x7f8728a3b0f0&gt;) &#45;&gt; None:&#10;Create a new tracer.&#10;If `file` is given, output to `file` instead of stdout.">
<text text-anchor="start" x="33" y="-408.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">__init__()</text>
</a>
</g>
<g id="a_node3_39"><a xlink:href="Tracer.html" xlink:title="changed_vars(self, new_vars:Dict[str, Any]) &#45;&gt; Dict[str, Any]:&#10;Track changed variables, based on `new_vars` observed.">
<text text-anchor="start" x="33" y="-397.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00" fill="#000000">changed_vars()</text>
</a>
</g>
<g id="a_node3_40"><a xlink:href="Tracer.html" xlink:title="_traceit(self, frame:frame, event:str, arg:Any) &#45;&gt; Union[Callable, NoneType]:&#10;Internal tracing function.">
<text text-anchor="start" x="33" y="-385.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">_traceit()</text>
</a>
</g>
<g id="a_node3_41"><a xlink:href="Tracer.html" xlink:title="log(self, *objects:Any, sep:str=&#39; &#39;, end:str=&#39;\n&#39;, flush:bool=True) &#45;&gt; None:&#10;Like `print()`, but always sending to `file` given at initialization,&#10;and flushing by default.">
<text text-anchor="start" x="33" y="-374.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">log()</text>
</a>
</g>
<g id="a_node3_42"><a xlink:href="Tracer.html" xlink:title="print_debugger_status(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Show current source line and changed vars">
<text text-anchor="start" x="33" y="-363.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00" fill="#000000">print_debugger_status()</text>
</a>
</g>
<g id="a_node3_43"><a xlink:href="Tracer.html" xlink:title="traceit(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Tracing function; called at every line. To be overloaded in subclasses.">
<text text-anchor="start" x="33" y="-353.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">traceit()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- Collector&#45;&gt;Tracer -->
<g id="edge2" class="edge">
<title>Collector&#45;&gt;Tracer</title>
<path fill="none" stroke="#000000" d="M102,-308.5621C102,-317.5702 102,-326.6017 102,-335.3292"/>
<polygon fill="none" stroke="#000000" points="98.5001,-335.415 102,-345.4151 105.5001,-335.4151 98.5001,-335.415"/>
</g>
<!-- Tracer&#45;&gt;StackInspector -->
<g id="edge3" class="edge">
<title>Tracer&#45;&gt;StackInspector</title>
<path fill="none" stroke="#000000" d="M119.3542,-464.5936C121.8594,-473.1966 124.489,-482.2264 127.1368,-491.3187"/>
<polygon fill="none" stroke="#000000" points="123.8555,-492.5695 130.012,-501.1921 130.5764,-490.6123 123.8555,-492.5695"/>
</g>
<!-- ValueCollector -->
<g id="node5" class="node">
<title>ValueCollector</title>
<g id="a_node5"><a xlink:href="#" xlink:title="class ValueCollector:&#10;&quot;A class to collect local variables and their values.">
<polygon fill="none" stroke="#000000" points="0,-11.5 0,-75.5 118,-75.5 118,-11.5 0,-11.5"/>
<text text-anchor="start" x="8" y="-61.3" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="14.00" fill="#6a0dad">ValueCollector</text>
<polyline fill="none" stroke="#000000" points="0,-52.5 118,-52.5 "/>
<g id="a_node5_44"><a xlink:href="#" xlink:title="ValueCollector">
<g id="a_node5_45"><a xlink:href="#" xlink:title="__init__(self) &#45;&gt; None:&#10;Constructor.">
<text text-anchor="start" x="29" y="-41" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">__init__()</text>
</a>
</g>
<g id="a_node5_46"><a xlink:href="#" xlink:title="events(self) &#45;&gt; Set[str]:&#10;A set of (variable, value) pairs observed">
<text text-anchor="start" x="29" y="-30" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00" fill="#000000">events()</text>
</a>
</g>
<g id="a_node5_47"><a xlink:href="#" xlink:title="collect(self, frame:frame, event:str, arg:Any) &#45;&gt; None:&#10;Collector function. To be overloaded in subclasses.">
<text text-anchor="start" x="29" y="-19" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00" fill="#000000">collect()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- ValueCollector&#45;&gt;Collector -->
<g id="edge5" class="edge">
<title>ValueCollector&#45;&gt;Collector</title>
<path fill="none" stroke="#000000" d="M66.9872,-75.5417C69.7429,-86.5965 72.9967,-99.6494 76.3924,-113.2719"/>
<polygon fill="none" stroke="#000000" points="73.0702,-114.415 78.8851,-123.2715 79.8623,-112.7218 73.0702,-114.415"/>
</g>
<!-- Legend -->
<g id="node6" class="node">
<title>Legend</title>
<text text-anchor="start" x="298" y="-61" font-family="Raleway, Helvetica, Arial, sans-serif" font-weight="bold" font-size="10.00" fill="#6a0dad">Legend</text>
<text text-anchor="start" x="298" y="-51" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="305" y="-51" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00" fill="#000000">public_method()</text>
<text text-anchor="start" x="298" y="-41" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="305" y="-41" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00" fill="#000000">private_method()</text>
<text text-anchor="start" x="298" y="-31" font-family="Raleway, Helvetica, Arial, sans-serif" font-size="10.00" fill="#000000">• </text>
<text text-anchor="start" x="305" y="-31" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00" fill="#000000">overloaded_method()</text>
<text text-anchor="start" x="298" y="-21.8" font-family="Helvetica,sans-Serif" font-size="9.00" fill="#000000">Hover over names to see doc</text>
</g>
</g>
</svg>
</p>
</div>
</div>
</div>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction">&#182;</a></h2><p>The idea behind <em>statistical debugging</em> is fairly simple. We have a program that sometimes passes and sometimes fails. This outcome can be <em>correlated</em> with events that precede it – properties of the input, properties of the execution, properties of the program state. If we, for instance, can find that "the program always fails when Line 123 is executed, and it always passes when Line 123 is <em>not</em> executed", then we have a strong correlation between Line 123 being executed and failure.</p>
<p>Such <em>correlation</em> does not necessarily mean <em>causation</em>. For this, we would have to prove that executing Line 123 <em>always</em> leads to failure, and that <em>not</em> executing it does not lead to (this) failure. Also, a correlation (or even a causation) does not mean that Line 123 contains the defect – for this, we would have to show that it actually is an error. Still, correlations make excellent hints as it comes to search for failure causes – in all generality, if you let your search be guided by <em>events that correlate with failures</em>, you are more likely to find <em>important hints on how the failure comes to be</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Collecting-Events">Collecting Events<a class="anchor-link" href="#Collecting-Events">&#182;</a></h2><p>How can we determine events that correlate with failure? We start with a general mechanism to actually <em>collect</em> events during execution. The abstract <code>Collector</code> class provides</p>
<ul>
<li>a <code>collect()</code> method made for collecting events, called from the <code>traceit()</code> tracer; and</li>
<li>an <code>events()</code> method made for retrieving these events.</li>
</ul>
<p>Both of these are <em>abstract</em> and will be defined further in subclasses.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Tracer.html" class="import" target="_blank">Tracer</a></span> <span class="kn">import</span> <span class="n">Tracer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/types.html" class="import" target="_blank">types</a></span> <span class="kn">import</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">TracebackType</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Collector</span><span class="p">(</span><span class="n">Tracer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to record events during execution.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Collecting function. To be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a collection of events. To be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A <code>Collector</code> class is used like <code>Tracer</code>, using a <code>with</code> statement. Let us apply it on the buggy variant of <code>remove_html_markup()</code> from the <a href="Intro_Debugging.html">Introduction to Debugging</a>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">remove_html_markup</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Collector</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
<span class="n">out</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;abc&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There's not much we can do with our collector, as the <code>collect()</code> and <code>events()</code> methods are yet empty. However, we can introduce an <code>id()</code> method which returns a string identifying the collector. This string is defined from the <em>first function call</em> encountered.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/types.html" class="import" target="_blank">types</a></span> <span class="kn">import</span> <span class="n">FunctionType</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Coverage</span> <span class="o">=</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Collector</span><span class="p">(</span><span class="n">Collector</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_argstring</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_to_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Tracing function. Saves the first function and calls collect().&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_to_ignore</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">],</span> <span class="bp">cls</span><span class="p">):</span>
                    <span class="c1"># Do not collect our own methods</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span>
            <span class="c1"># Save function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_argstring</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">[</span><span class="n">var</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span> 
                                         <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Collector function. To be overloaded in subclasses.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return an identifier for the collector, </span>
<span class="sd">        created from the first call&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">argstring</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the function from the first call, as a function object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No call collected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span>

    <span class="k">def</span> <span class="nf">argstring</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the list of arguments from the first call, as a printable string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argstring</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No call collected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argstring</span>

    <span class="k">def</span> <span class="nf">args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a dict of argument names and values from the first call&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No call collected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>

    <span class="k">def</span> <span class="nf">exception</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the exception class from the first call,</span>
<span class="sd">        or None if no exception was raised.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a string representation of the collector&quot;&quot;&quot;</span>
        <span class="c1"># We use the ID as default representation when printed</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">covered_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Set of covered functions. To be overloaded in subclasses.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Coverage</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set (function, lineno) with locations covered.</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's how the collector works:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Collector</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">function</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&lt;function __main__.remove_html_markup(s)&gt;, &#34;remove_html_markup(s=&#39;abc&#39;)&#34;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Error-Prevention">Error Prevention<a class="anchor-link" href="#Error-Prevention">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While collecting, we'd like to avoid collecting events in the collection infrastructure. The <code>classes_to_ignore</code> attribute takes care of this.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Collector</span><span class="p">(</span><span class="n">Collector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_classes_to_ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes_to_ignore</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define additional classes to ignore during collection</span>
<span class="sd">        (typically `Debugger` classes using these collectors).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_to_ignore</span> <span class="o">+=</span> <span class="n">classes_to_ignore</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we exit a block without having collected anything, that's likely an error.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Collector</span><span class="p">(</span><span class="n">Collector</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_tp</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
                 <span class="n">exc_traceback</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Exit the `with` block.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_tp</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exc_tp</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># re-raise exception</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No call collected&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Collecting-Coverage">Collecting Coverage<a class="anchor-link" href="#Collecting-Coverage">&#182;</a></h2><p>So far, our <code>Collector</code> class does not collect any events. Let us extend it such that it collects <em>coverage</em> information – that is, the set of locations executed. To this end, we introduce a <code>CoverageCollector</code> subclass which saves the coverage in a set containing functions and line numbers.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/types.html" class="import" target="_blank">types</a></span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">FrameType</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="StackInspector.html" class="import" target="_blank">StackInspector</a></span> <span class="kn">import</span> <span class="n">StackInspector</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CoverageCollector</span><span class="p">(</span><span class="n">Collector</span><span class="p">,</span> <span class="n">StackInspector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to record covered locations during execution.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span><span class="p">:</span> <span class="n">Coverage</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save coverage for an observed event.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We also override <code>events()</code> such that it returns the set of covered locations.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CoverageCollector</span><span class="p">(</span><span class="n">CoverageCollector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the set of locations covered.</span>
<span class="sd">        Each location comes as a pair (`function_name`, `lineno`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span><span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The methods <code>coverage()</code> and <code>covered_functions()</code> allow precise access to the coverage obtained.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CoverageCollector</span><span class="p">(</span><span class="n">CoverageCollector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">covered_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a set with all functions covered.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">func</span> <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Coverage</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a set (function, lineno) with all locations covered.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is how we can use <code>CoverageCollector</code> to determine the lines executed during a run of <code>remove_html_markup()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CoverageCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Sets of line numbers alone are not too revealing. They provide more insights if we actually list the code, highlighting these numbers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook/tree/master/notebooks/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">getsourcelines</span>    <span class="c1"># like inspect.getsourcelines(), but in color</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">code_with_coverage</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">coverage</span><span class="p">:</span> <span class="n">Coverage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">source_lines</span><span class="p">,</span> <span class="n">starting_line_number</span> <span class="o">=</span> \
       <span class="n">getsourcelines</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

    <span class="n">line_number</span> <span class="o">=</span> <span class="n">starting_line_number</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">source_lines</span><span class="p">:</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coverage</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line_number</span><span class="si">:</span><span class="s2">4</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">line_number</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_with_coverage</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">coverage</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>   1 * <span class="ansi-blue-fg">def</span> <span class="ansi-green-fg">remove_html_markup</span>(s):  <span class="ansi-white-fg"># type: ignore</span>
   2 *     tag = <span class="ansi-blue-fg">False</span>
   3 *     quote = <span class="ansi-blue-fg">False</span>
   4 *     out = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#34;</span>
   5   
   6 *     <span class="ansi-blue-fg">for</span> c <span class="ansi-magenta-fg">in</span> s:
   7 *         <span class="ansi-blue-fg">if</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&lt;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">and</span> <span class="ansi-magenta-fg">not</span> quote:
   8               tag = <span class="ansi-blue-fg">True</span>
   9 *         <span class="ansi-blue-fg">elif</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&gt;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">and</span> <span class="ansi-magenta-fg">not</span> quote:
  10               tag = <span class="ansi-blue-fg">False</span>
  11 *         <span class="ansi-blue-fg">elif</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">or</span> c == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&#34;</span> <span class="ansi-magenta-fg">and</span> tag:
  12               quote = <span class="ansi-magenta-fg">not</span> quote
  13 *         <span class="ansi-blue-fg">elif</span> <span class="ansi-magenta-fg">not</span> tag:
  14 *             out = out + c
  15   
  16 *     <span class="ansi-blue-fg">return</span> out
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Remember that the input <code>s</code> was <code>"abc"</code>? In this listing, we can see which lines were covered and which lines were not. From the listing already, we can see that <code>s</code> has neither tags nor quotes.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Such coverage computation plays a big role in <em>testing</em>, as one wants tests to cover as many different aspects of program execution (and notably code) as possible. But also during debugging, code coverage is essential: If some code was not even executed in the failing run, then any change to it will have no effect.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://github.com/uds-se/fuzzingbook/tree/master/notebooks/bookutils" class="import" target="_blank">bookutils</a></span> <span class="kn">import</span> <span class="n">quiz</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Let the input be <code>"&lt;b&gt;Don't do this!&lt;/b&gt;"</code>. Which of these lines are executed? Use the code to find out!</div>
    </p>
    <p>
    <div class="quiz_options" title="Check all that apply.">

        <input type="checkbox" name="b1498a08-82bc-11eb-a588-acde48001122" id="b1498a08-82bc-11eb-a588-acde48001122-1" onclick="clear_selection('b1498a08-82bc-11eb-a588-acde48001122')">
        <label id="b1498a08-82bc-11eb-a588-acde48001122-1-label" for="b1498a08-82bc-11eb-a588-acde48001122-1"><code>tag = True</code></label><br>

        <input type="checkbox" name="b1498a08-82bc-11eb-a588-acde48001122" id="b1498a08-82bc-11eb-a588-acde48001122-2" onclick="clear_selection('b1498a08-82bc-11eb-a588-acde48001122')">
        <label id="b1498a08-82bc-11eb-a588-acde48001122-2-label" for="b1498a08-82bc-11eb-a588-acde48001122-2"><code>tag = False</code></label><br>

        <input type="checkbox" name="b1498a08-82bc-11eb-a588-acde48001122" id="b1498a08-82bc-11eb-a588-acde48001122-3" onclick="clear_selection('b1498a08-82bc-11eb-a588-acde48001122')">
        <label id="b1498a08-82bc-11eb-a588-acde48001122-3-label" for="b1498a08-82bc-11eb-a588-acde48001122-3"><code>quote = not quote</code></label><br>

        <input type="checkbox" name="b1498a08-82bc-11eb-a588-acde48001122" id="b1498a08-82bc-11eb-a588-acde48001122-4" onclick="clear_selection('b1498a08-82bc-11eb-a588-acde48001122')">
        <label id="b1498a08-82bc-11eb-a588-acde48001122-4-label" for="b1498a08-82bc-11eb-a588-acde48001122-4"><code>out = out + c</code></label><br>

    </div>
    </p>
    <input id="b1498a08-82bc-11eb-a588-acde48001122-submit" type="submit" value="Submit" onclick="check_selection('b1498a08-82bc-11eb-a588-acde48001122', 22, 1, '[ord(c) - ord(\&#x27;a\&#x27;) - 1 for c in \&#x27;cdf\&#x27;]')">
    <span class="quiz_hint" id="b1498a08-82bc-11eb-a588-acde48001122-hint"></span>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To find the solution, try this out yourself:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CoverageCollector</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;Don&#39;t do this!&lt;/b&gt;&quot;</span><span class="p">)</span>
<span class="c1"># code_with_coverage(remove_html_markup, c.coverage)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Computing-Differences">Computing Differences<a class="anchor-link" href="#Computing-Differences">&#182;</a></h2><p>Let us get back to the idea that we want to <em>correlate</em> events with passing and failing outcomes. For this, we need to examine events in both <em>passing</em> and <em>failing</em> runs, and determine their <em>differences</em> – since it is these differences we want to associate with their respective outcome.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Base-Class-for-Statistical-Debugging">A Base Class for Statistical Debugging<a class="anchor-link" href="#A-Base-Class-for-Statistical-Debugging">&#182;</a></h3><p>The <code>StatisticalDebugger</code> base class takes a collector class (such as <code>CoverageCollector</code>). Its <code>collect()</code> method creates a new collector of that very class, which will be maintained by the debugger. As argument, <code>collect()</code> takes a string characterizing the outcome (such as <code>'PASS'</code> or <code>'FAIL'</code>). This is how one would use it:</p>
<div class="highlight"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">StatisticalDebugger</span><span class="p">()</span>
<span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">some_passing_run</span><span class="p">()</span>
<span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">another_passing_run</span><span class="p">()</span>
<span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;FAIL&#39;</span><span class="p">):</span>
    <span class="n">some_failing_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us implement <code>StatisticalDebugger</code>. The base class gets a collector class as argument:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">StatisticalDebugger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class to collect events for multiple outcomes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector_class</span><span class="p">:</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">CoverageCollector</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor. Use instances of `collector_class` to collect events.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector_class</span> <span class="o">=</span> <span class="n">collector_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Collector</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>collect()</code> method creates (and stores) a collector for the given outcome, using the given outcome to characterize the run. Any additional arguments are passed to the collector.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">StatisticalDebugger</span><span class="p">(</span><span class="n">StatisticalDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collector</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a collector for the given outcome. </span>
<span class="sd">        Additional args are passed to the collector.&quot;&quot;&quot;</span>
        <span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">collector</span><span class="o">.</span><span class="n">add_classes_to_ignore</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_collector</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">collector</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_collector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collector</span><span class="p">:</span> <span class="n">Collector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collector</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collector</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">collector</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>all_events()</code> method produces a union of all events observed. If an outcome is given, it produces a union of all events with that outcome:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">StatisticalDebugger</span><span class="p">(</span><span class="n">StatisticalDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">all_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a set of all events observed.&quot;&quot;&quot;</span>
        <span class="n">all_events</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outcome</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]:</span>
                <span class="n">all_events</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]:</span>
                    <span class="n">all_events</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">all_events</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's a simple example of <code>StatisticalDebugger</code> in action:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">StatisticalDebugger</span><span class="p">()</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;FAIL&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>all_events()</code> returns all events collected:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">all_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 8),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 10),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 12),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If given an outcome as argument, we obtain all events with the given outcome.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">all_events</span><span class="p">(</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 12),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The attribute <code>collectors</code> maps outcomes to lists of collectors:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">collectors</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;PASS&#39;: [remove_html_markup(s=&#39;abc&#39;), remove_html_markup(s=&#39;&lt;b&gt;abc&lt;/b&gt;&#39;)],
 &#39;FAIL&#39;: [remove_html_markup(s=&#39;&#34;abc&#34;&#39;)]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the collector of the one (and first) passing run:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="s1">&#39;PASS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#34;remove_html_markup(s=&#39;abc&#39;)&#34;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="s1">&#39;PASS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To better highlight the differences between the collected events, we introduce a method <code>event_table()</code> that prints out whether an event took place in a run.</p>
</div>
</div>
</div>
</div>

<details id="Excursion:-Printing-an-Event-Table">
<summary>Printing an Event Table</summary>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html" class="import" target="_blank">IPython.display</a></span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/html.html" class="import" target="_blank">html</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">StatisticalDebugger</span><span class="p">(</span><span class="n">StatisticalDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the entry function from the events observed,</span>
<span class="sd">        or None if ambiguous.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names_seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]:</span>
                <span class="c1"># We may have multiple copies of the function,</span>
                <span class="c1"># but sharing the same name</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names_seen</span><span class="p">:</span>
                    <span class="n">functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                    <span class="n">names_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># ambiguous</span>
        <span class="k">return</span> <span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">covered_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a set of all functions observed.&quot;&quot;&quot;</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]:</span>
                <span class="n">functions</span> <span class="o">|=</span> <span class="n">collector</span><span class="o">.</span><span class="n">covered_functions</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">functions</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Coverage</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a set of all (functions, line_numbers) observed&quot;&quot;&quot;</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">outcome</span><span class="p">]:</span>
                <span class="n">coverage</span> <span class="o">|=</span> <span class="n">collector</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">coverage</span>

    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a color for the given event, or None.</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a tooltip string for the given event, or None.</span>
<span class="sd">        To be overloaded in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">event_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Format the given event. To be overloaded in subclasses.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">event</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_str</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">event_table_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print out a table of events observed.</span>
<span class="sd">        If `args` is True, use arguments as headers.</span>
<span class="sd">        If `color` is True, use colors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; | &#39;</span>
        <span class="n">all_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">()</span>
        <span class="n">longest_event</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_str</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">all_events</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Header</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;| &#39;</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;`&#39;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;`&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;`&#39;</span> <span class="o">+</span> <span class="n">collector</span><span class="o">.</span><span class="n">argstring</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;`&#39;</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;| &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">longest_event</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;| &#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="n">longest_event</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">name</span><span class="p">])):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="c1"># Data</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_events</span><span class="p">):</span>
            <span class="n">event_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_str</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">longest_event</span><span class="p">)</span>

            <span class="n">tooltip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tooltip</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; title=&quot;</span><span class="si">{</span><span class="n">tooltip</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                <span class="n">color_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">color_name</span><span class="p">:</span>
                    <span class="n">event_name</span> <span class="o">=</span> \
                        <span class="sa">f</span><span class="s1">&#39;&lt;samp style=&quot;background-color: </span><span class="si">{</span><span class="n">color_name</span><span class="si">}</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&gt;&#39;</span> \
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> \
                        <span class="sa">f</span><span class="s1">&#39;&lt;/samp&gt;&#39;</span>

            <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">():</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;X&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;-&quot;</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">sep</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">event_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">_args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Print out event table in Markdown format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Markdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_table_text</span><span class="p">(</span><span class="o">**</span><span class="n">_args</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_table_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_markdown_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_table_text</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

</details>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">StatisticalDebugger</span><span class="p">()</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;PASS&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">s</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s1">&#39;FAIL&#39;</span><span class="p">):</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">event_table</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_markdown rendered_html output_subarea output_execute_result">

<table>
<thead><tr>
<th><code>remove_html_markup</code></th>
<th><code>s='abc'</code></th>
<th><code>s='&lt;b&gt;abc&lt;/b&gt;'</code></th>
<th><code>s='"abc"'</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>remove_html_markup:1</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:2</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:3</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:4</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:6</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:7</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:8</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td>remove_html_markup:9</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:10</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td>remove_html_markup:11</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:12</td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:13</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:14</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:16</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>

</div>

</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">How many lines are executed in the failing run only?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="b15c1bc8-82bc-11eb-8163-acde48001122" id="b15c1bc8-82bc-11eb-8163-acde48001122-1" onclick="clear_selection('b15c1bc8-82bc-11eb-8163-acde48001122')">
        <label id="b15c1bc8-82bc-11eb-8163-acde48001122-1-label" for="b15c1bc8-82bc-11eb-8163-acde48001122-1">One</label><br>

        <input type="radio" name="b15c1bc8-82bc-11eb-8163-acde48001122" id="b15c1bc8-82bc-11eb-8163-acde48001122-2" onclick="clear_selection('b15c1bc8-82bc-11eb-8163-acde48001122')">
        <label id="b15c1bc8-82bc-11eb-8163-acde48001122-2-label" for="b15c1bc8-82bc-11eb-8163-acde48001122-2">Two</label><br>

        <input type="radio" name="b15c1bc8-82bc-11eb-8163-acde48001122" id="b15c1bc8-82bc-11eb-8163-acde48001122-3" onclick="clear_selection('b15c1bc8-82bc-11eb-8163-acde48001122')">
        <label id="b15c1bc8-82bc-11eb-8163-acde48001122-3-label" for="b15c1bc8-82bc-11eb-8163-acde48001122-3">Three</label><br>

    </div>
    </p>
    <input id="b15c1bc8-82bc-11eb-8163-acde48001122-submit" type="submit" value="Submit" onclick="check_selection('b15c1bc8-82bc-11eb-8163-acde48001122', 4, 0, 'int(chr(50))')">
    <span class="quiz_hint" id="b15c1bc8-82bc-11eb-8163-acde48001122-hint"></span>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These lines only executed in the failing run would be a correlation to look for.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Collecting-Passing-and-Failing-Runs">Collecting Passing and Failing Runs<a class="anchor-link" href="#Collecting-Passing-and-Failing-Runs">&#182;</a></h3><p>While our <code>StatisticalDebugger</code> class allows arbitrary outcomes, we are typically only interested in two outcomes, namely <em>passing</em> vs. <em>failing</em> runs. We therefore introduce a specialized <code>DifferenceDebugger</code> class that provides customized methods to collect and access passing and failing runs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DifferenceDebugger</span><span class="p">(</span><span class="n">StatisticalDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to collect events for passing and failing outcomes.&quot;&quot;&quot;</span>

    <span class="n">PASS</span> <span class="o">=</span> <span class="s1">&#39;PASS&#39;</span>
    <span class="n">FAIL</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>

    <span class="k">def</span> <span class="nf">collect_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collector</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a collector for passing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PASS</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">collect_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collector</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a collector for failing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pass_collectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Collector</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">PASS</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fail_collectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Collector</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">all_fail_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all events observed in failing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">all_pass_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all events observed in passing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PASS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">only_fail_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all events observed only in failing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fail_events</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_pass_events</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">only_pass_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return all events observed only in passing runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_pass_events</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fail_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use <code>DifferenceDebugger</code> just as a <code>StatisticalDebugger</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T1</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;DifferenceDebugger&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_debugger_html_simple</span><span class="p">(</span><span class="n">debugger</span><span class="p">:</span> <span class="n">T1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T1</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_fail</span><span class="p">():</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, since the outcome of tests may not always be predetermined, we provide a simpler interface for tests that can fail (= raise an exception) or pass (not raise an exception).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/traceback.html" class="import" target="_blank">traceback</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DifferenceDebugger</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Enter a `with` block. Collect coverage and outcome;</span>
<span class="sd">        classify as FAIL if the block raises an exception,</span>
<span class="sd">        and PASS if it does not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector_class</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">add_classes_to_ignore</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_tp</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span><span class="p">,</span>
                 <span class="n">exc_traceback</span><span class="p">:</span> <span class="n">TracebackType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Exit the `with` block.&quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_tp</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Internal error; re-raise exception</span>

        <span class="k">if</span> <span class="n">exc_tp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_collector</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Ignore exception, if any</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using this interface, we can rewrite <code>test_debugger_html()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T2</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;DifferenceDebugger&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_debugger_html</span><span class="p">(</span><span class="n">debugger</span><span class="p">:</span> <span class="n">T2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T2</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;abc&lt;/b&gt;&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="p">:</span>
        <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&quot;abc&quot;&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># Mark test as failing</span>

    <span class="k">return</span> <span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_debugger_html</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_markdown rendered_html output_subarea output_execute_result">

<table>
<thead><tr>
<th><code>remove_html_markup</code></th>
<th><code>s='abc'</code></th>
<th><code>s='&lt;b&gt;abc&lt;/b&gt;'</code></th>
<th><code>s='"abc"'</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>remove_html_markup:1</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:2</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:3</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:4</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:6</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:7</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:8</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td>remove_html_markup:9</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:10</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td>remove_html_markup:11</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:12</td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:13</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:14</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>remove_html_markup:16</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Analyzing-Events">Analyzing Events<a class="anchor-link" href="#Analyzing-Events">&#182;</a></h3><p>Let us now focus on <em>analyzing</em> events collected. Since events come back as <em>sets</em>, we can compute <em>unions</em> and <em>differences</em> between these sets. For instance, we can compute which lines were executed in <em>any</em> of the passing runs of <code>test_debugger_html()</code>, above:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pass_1_events</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">pass_collectors</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pass_2_events</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">pass_collectors</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">in_any_pass</span> <span class="o">=</span> <span class="n">pass_1_events</span> <span class="o">|</span> <span class="n">pass_2_events</span>
<span class="n">in_any_pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 8),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 10),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, we can determine which lines were <em>only</em> executed in the failing run:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fail_events</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">fail_collectors</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">only_in_fail</span> <span class="o">=</span> <span class="n">fail_events</span> <span class="o">-</span> <span class="n">in_any_pass</span>
<span class="n">only_in_fail</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 12)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And we see that the "failing" run is characterized by processing quotes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code_with_coverage</span><span class="p">(</span><span class="n">remove_html_markup</span><span class="p">,</span> <span class="n">only_in_fail</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>   1   <span class="ansi-blue-fg">def</span> <span class="ansi-green-fg">remove_html_markup</span>(s):  <span class="ansi-white-fg"># type: ignore</span>
   2       tag = <span class="ansi-blue-fg">False</span>
   3       quote = <span class="ansi-blue-fg">False</span>
   4       out = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#34;</span>
   5   
   6       <span class="ansi-blue-fg">for</span> c <span class="ansi-magenta-fg">in</span> s:
   7           <span class="ansi-blue-fg">if</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&lt;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">and</span> <span class="ansi-magenta-fg">not</span> quote:
   8               tag = <span class="ansi-blue-fg">True</span>
   9           <span class="ansi-blue-fg">elif</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&gt;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">and</span> <span class="ansi-magenta-fg">not</span> quote:
  10               tag = <span class="ansi-blue-fg">False</span>
  11           <span class="ansi-blue-fg">elif</span> c == <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-magenta-fg">or</span> c == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">&#34;</span> <span class="ansi-magenta-fg">and</span> tag:
  12               quote = <span class="ansi-magenta-fg">not</span> quote
  13           <span class="ansi-blue-fg">elif</span> <span class="ansi-magenta-fg">not</span> tag:
  14               out = out + c
  15   
  16       <span class="ansi-blue-fg">return</span> out
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">all_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 8),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 10),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 12),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 16)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These are the lines executed only in the failing run:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 12)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These are the lines executed only in the passing runs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">only_pass_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;remove_html_markup&#39;, 8), (&#39;remove_html_markup&#39;, 10)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, having these lines individually is neat, but things become much more interesting if we can see the associated code lines just as well. That's what we will do in the next section.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Visualizing-Differences">Visualizing Differences<a class="anchor-link" href="#Visualizing-Differences">&#182;</a></h2><p>To show correlations of line coverage in context, we introduce a number of <em>visualization</em> techniques that <em>highlight</em> code with different colors.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Discrete-Spectrum">Discrete Spectrum<a class="anchor-link" href="#Discrete-Spectrum">&#182;</a></h3><p>The first idea is to use a <em>discrete</em> spectrum of three colors:</p>
<ul>
<li><em>red</em> for code executed in failing runs only</li>
<li><em>green</em> for code executed in passing runs only</li>
<li><em>yellow</em> for code executed in both passing and failing runs.</li>
</ul>
<p>Code that is not executed stays unhighlighted.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our <code>DiscreteSpectrumDebugger</code> subclass provides a <code>color()</code> method that returns one of these three colors depending on the line number:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DiscreteSpectrumDebugger</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visualize differences between executions using three discrete colors&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">suspiciousness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a suspiciousness value [0, 1.0]</span>
<span class="sd">        for the given event, or `None` if unknown&quot;&quot;&quot;</span>
        <span class="n">passing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_pass_events</span><span class="p">()</span>
        <span class="n">failing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fail_events</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">passing</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">failing</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.5</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">failing</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">passing</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a color for the given event.&quot;&quot;&quot;</span>
        <span class="n">suspiciousness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suspiciousness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">suspiciousness</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;mistyrose&#39;</span>
        <span class="k">if</span> <span class="n">suspiciousness</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;lightyellow&#39;</span>

        <span class="k">return</span> <span class="s1">&#39;honeydew&#39;</span>

    <span class="k">def</span> <span class="nf">tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a tooltip for the given event.&quot;&quot;&quot;</span>
        <span class="n">passing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_pass_events</span><span class="p">()</span>
        <span class="n">failing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fail_events</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">passing</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">failing</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;in passing and failing runs&quot;</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">failing</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;only in failing runs&quot;</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">passing</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;only in passing runs&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;never&quot;</span>

    <span class="k">def</span> <span class="nf">percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the suspiciousness for the given event as percentage string&quot;&quot;&quot;</span>
        <span class="n">suspiciousness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suspiciousness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">suspiciousness</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;100%&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>code()</code> method takes a function and shows each of its source code lines using the given spectrum, using HTML markup:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DiscreteSpectrumDebugger</span><span class="p">(</span><span class="n">DiscreteSpectrumDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> 
             <span class="n">color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">suspiciousness</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">line_numbers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a listing of `functions` (default: covered functions).</span>
<span class="sd">        If `color` is True, render as HTML, using suspiciousness colors.</span>
<span class="sd">        If `suspiciousness` is True, include suspiciousness values.</span>
<span class="sd">        If `line_numbers` is True (default), include line numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">functions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covered_functions</span><span class="p">()</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
            <span class="n">source_lines</span><span class="p">,</span> <span class="n">starting_line_number</span> <span class="o">=</span> \
               <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">starting_line_number</span><span class="p">)</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">starting_line_number</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;&lt;p/&gt;&#39;</span>

            <span class="n">line_number</span> <span class="o">=</span> <span class="n">starting_line_number</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">source_lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span>

                <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">line_number</span><span class="p">)</span>
                <span class="n">location_suspiciousness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">location_suspiciousness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tooltip</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tooltip</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Line </span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">: not executed&quot;</span>

                <span class="k">if</span> <span class="n">suspiciousness</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="p">(</span><span class="n">location</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span>

                <span class="k">if</span> <span class="n">line_numbers</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_number</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span>

                <span class="n">line_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">color</span> <span class="ow">and</span> <span class="n">line_color</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;&lt;pre style=&quot;background-color:</span><span class="si">{</span><span class="n">line_color</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                    title=&quot;</span><span class="si">{</span><span class="n">tooltip</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s1">&lt;/pre&gt;&#39;&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">color</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;pre title=&quot;</span><span class="si">{</span><span class="n">tooltip</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&lt;/pre&gt;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

                <span class="n">out</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">line_number</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;When output in Jupyter, visualize as HTML&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show code as string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suspiciousness</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Show code as string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suspiciousness</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is how the <code>only_pass_events()</code> and <code>only_fail_events()</code> sets look like when visualized with code. The "culprit" line is well highlighted:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">DiscreteSpectrumDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:lightyellow"
                    title="Line 1: in passing and failing runs">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:lightyellow"
                    title="Line 2: in passing and failing runs">   2     tag = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 3: in passing and failing runs">   3     quote = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 4: in passing and failing runs">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:lightyellow"
                    title="Line 6: in passing and failing runs">   6     for c in s:</pre>
<pre style="background-color:lightyellow"
                    title="Line 7: in passing and failing runs">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:honeydew"
                    title="Line 8: only in passing runs">   8             tag = True</pre>
<pre style="background-color:lightyellow"
                    title="Line 9: in passing and failing runs">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:honeydew"
                    title="Line 10: only in passing runs">  10             tag = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 11: in passing and failing runs">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:mistyrose"
                    title="Line 12: only in failing runs">  12             quote = not quote</pre>
<pre style="background-color:lightyellow"
                    title="Line 13: in passing and failing runs">  13         elif not tag:</pre>
<pre style="background-color:lightyellow"
                    title="Line 14: in passing and failing runs">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:lightyellow"
                    title="Line 16: in passing and failing runs">  16     return out</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can clearly see that the failure is correlated with the presence of quotes in the input string (which is an important hint!). But does this also show us <em>immediately</em> where the defect to be fixed is?</p>
</div>
</div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Does the line <code>quote = not quote</code> actually contain the defect?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="b172a9cc-82bc-11eb-9732-acde48001122" id="b172a9cc-82bc-11eb-9732-acde48001122-1" onclick="clear_selection('b172a9cc-82bc-11eb-9732-acde48001122')">
        <label id="b172a9cc-82bc-11eb-9732-acde48001122-1-label" for="b172a9cc-82bc-11eb-9732-acde48001122-1">Yes, it should be fixed</label><br>

        <input type="radio" name="b172a9cc-82bc-11eb-9732-acde48001122" id="b172a9cc-82bc-11eb-9732-acde48001122-2" onclick="clear_selection('b172a9cc-82bc-11eb-9732-acde48001122')">
        <label id="b172a9cc-82bc-11eb-9732-acde48001122-2-label" for="b172a9cc-82bc-11eb-9732-acde48001122-2">No, the defect is elsewhere</label><br>

    </div>
    </p>
    <input id="b172a9cc-82bc-11eb-9732-acde48001122-submit" type="submit" value="Submit" onclick="check_selection('b172a9cc-82bc-11eb-9732-acde48001122', 4, 0, '164 * 2 % 326')">
    <span class="quiz_hint" id="b172a9cc-82bc-11eb-9732-acde48001122-hint"></span>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, it is the preceding condition that is wrong. In order to fix a program, we have to find a location that</p>
<ol>
<li><em>causes</em> the failure (i.e., it can be changed to make the failure go away); and</li>
<li>is a <em>defect</em> (i.e., contains an error).</li>
</ol>
<p>In our example above, the highlighted code line is a <em>symptom</em> for the error. To some extent, it is also a <em>cause</em>, since, say, commenting it out would also resolve the given failure, at the cost of causing other failures. However, the preceding condition also is a cause, as is the presence of quotes in the input.</p>
<p>Only one of these also is a <em>defect</em>, though, and that is the preceding condition. Hence, while correlations can provide important hints, they do not necessarily locate defects.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For those of us who may not have color HTML output ready, simply printing the debugger lists suspiciousness values as percentages.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">debugger</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>   1  50% def remove_html_markup(s):  # type: ignore
   2  50%     tag = False
   3  50%     quote = False
   4  50%     out = &#34;&#34;
   5
   6  50%     for c in s:
   7  50%         if c == &#39;&lt;&#39; and not quote:
   8   0%             tag = True
   9  50%         elif c == &#39;&gt;&#39; and not quote:
  10   0%             tag = False
  11  50%         elif c == &#39;&#34;&#39; or c == &#34;&#39;&#34; and tag:
  12 100%             quote = not quote
  13  50%         elif not tag:
  14  50%             out = out + c
  15
  16  50%     return out
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Continuous-Spectrum">Continuous Spectrum<a class="anchor-link" href="#Continuous-Spectrum">&#182;</a></h3><p>The criterion that an event should <em>only</em> occur in failing runs (and not in passing runs) can be too aggressive. In particular, if we have another run that executes the "culprit" lines, but does <em>not</em> fail, our "only in fail" criterion will no longer be helpful.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is an example. The input</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">b</span> <span class="na">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">&gt;</span>text<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</pre></div>
<p>will trigger the "culprit" line</p>
<div class="highlight"><pre><span></span><span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</pre></div>
<p>but actually produce an output where the tags are properly stripped:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b color=&quot;blue&quot;&gt;text&lt;/b&gt;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;text&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As a consequence, we no longer have lines that are being executed only in failing runs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">DiscreteSpectrumDebugger</span><span class="p">())</span>
<span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
    <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b link=&quot;blue&quot;&gt;&lt;/b&gt;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>set()
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In our spectrum output, the effect now is that the "culprit" line is as yellow as all others.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:lightyellow"
                    title="Line 1: in passing and failing runs">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:lightyellow"
                    title="Line 2: in passing and failing runs">   2     tag = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 3: in passing and failing runs">   3     quote = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 4: in passing and failing runs">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:lightyellow"
                    title="Line 6: in passing and failing runs">   6     for c in s:</pre>
<pre style="background-color:lightyellow"
                    title="Line 7: in passing and failing runs">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:honeydew"
                    title="Line 8: only in passing runs">   8             tag = True</pre>
<pre style="background-color:lightyellow"
                    title="Line 9: in passing and failing runs">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:honeydew"
                    title="Line 10: only in passing runs">  10             tag = False</pre>
<pre style="background-color:lightyellow"
                    title="Line 11: in passing and failing runs">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:lightyellow"
                    title="Line 12: in passing and failing runs">  12             quote = not quote</pre>
<pre style="background-color:lightyellow"
                    title="Line 13: in passing and failing runs">  13         elif not tag:</pre>
<pre style="background-color:lightyellow"
                    title="Line 14: in passing and failing runs">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:lightyellow"
                    title="Line 16: in passing and failing runs">  16     return out</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We therefore introduce a different method for highlighting lines, based on their <em>relative</em> occurrence with respect to all runs: If a line has been <em>mostly</em> executed in failing runs, its color should shift towards red; if a line has been <em>mostly</em> executed in passing runs, its color should shift towards green.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This <em>continuous spectrum</em> has been introduced by the seminal <em>Tarantula</em> tool [<a href="https://doi.org/10.1145/581339.581397">Jones <em>et al</em>, 2002.</a>]. In Tarantula, the color <em>hue</em> for each line is defined as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">$$() =  + ()}{\%() + \%()} \times $$</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here, <code>%passed</code> and <code>%failed</code> denote the percentage at which a line has been executed in passing and failing runs, respectively. A hue of 0.0 stands for red, a hue of 1.0 stands for green, and a hue of 0.5 stands for equal fractions of red and green, yielding yellow.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can implement these measures right away as methods in a new <code>ContinuousSpectrumDebugger</code> class:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ContinuousSpectrumDebugger</span><span class="p">(</span><span class="n">DiscreteSpectrumDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visualize differences between executions using a color spectrum&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">collectors_with_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Collector</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all collectors in a category</span>
<span class="sd">        that observed the given event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="n">collectors_with_event</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">collector</span> <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">all_runs</span> 
                                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">collectors_with_event</span>

    <span class="k">def</span> <span class="nf">collectors_without_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Collector</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all collectors in a category</span>
<span class="sd">        that did not observe the given event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="n">collectors_without_event</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">collector</span> <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">all_runs</span> 
                              <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">collectors_without_event</span>

    <span class="k">def</span> <span class="nf">event_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">all_collectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="n">collectors_with_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collectors_with_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collectors_with_event</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_collectors</span><span class="p">)</span>
        <span class="c1"># print(f&quot;%{category}({event}) = {fraction}&quot;)</span>
        <span class="k">return</span> <span class="n">fraction</span>

    <span class="k">def</span> <span class="nf">passed_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">failed_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a color hue from 0.0 (red) to 1.0 (green).&quot;&quot;&quot;</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passed_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">passed</span> <span class="o">+</span> <span class="n">failed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">passed</span> <span class="o">/</span> <span class="p">(</span><span class="n">passed</span> <span class="o">+</span> <span class="n">failed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Having a continuous hue also implies a continuous suspiciousness and associated tooltips:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ContinuousSpectrumDebugger</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">suspiciousness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">hue</span>

    <span class="k">def</span> <span class="nf">tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The hue for lines executed only in failing runs is (deep) red, as expected:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">debugger</span><span class="o">.</span><span class="n">hue</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;remove_html_markup&#39;, 12) 0.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, the hue for lines executed in passing runs is (deep) green:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_pass_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">debugger</span><span class="o">.</span><span class="n">hue</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;remove_html_markup&#39;, 10) 1.0
(&#39;remove_html_markup&#39;, 8) 1.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The Tarantula tool not only sets the hue for a line, but also uses <em>brightness</em> as measure for support – that is, how often was the line executed at all. The brighter a line, the stronger the correlation with a passing or failing outcome.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The brightness is defined as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">$$(line) = \max(\%(), \%())$$</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>and it is easily implemented, too:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ContinuousSpectrumDebugger</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">passed_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_fraction</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our single "only in fail" line has a brightness of 1.0 (the maximum).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">())</span>
<span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">debugger</span><span class="o">.</span><span class="n">brightness</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;remove_html_markup&#39;, 12) 1.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now define a color for each line. To this end, we override the (previously discrete) <code>color()</code> method such that it returns a color specification giving hue and brightness. We use the HTML format <code>hsl(hue, saturation, lightness)</code> where the hue is given as a value between 0 and 360 (0 is red, 120 is green) and saturation and lightness are provided as percentages.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ContinuousSpectrumDebugger</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">saturation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># HSL color values are specified with: </span>
        <span class="c1"># hsl(hue, saturation, lightness).</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;hsl(</span><span class="si">{</span><span class="n">hue</span> <span class="o">*</span> <span class="mi">120</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">saturation</span> <span class="o">*</span> <span class="mi">100</span><span class="si">}</span><span class="s2">%, 80%)&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Lines executed only in failing runs are still shown in red:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">debugger</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;remove_html_markup&#39;, 12) hsl(0.0, 100.0%, 80%)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... whereas lines executed only in passing runs are still shown in green:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_pass_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">debugger</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">location</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;remove_html_markup&#39;, 10) hsl(120.0, 50.0%, 80%)
(&#39;remove_html_markup&#39;, 8) hsl(120.0, 50.0%, 80%)
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 1:  50%">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 2:  50%">   2     tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 3:  50%">   3     quote = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 4:  50%">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 6:  50%">   6     for c in s:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 7:  50%">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 8:   0%">   8             tag = True</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 9:  50%">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 10:   0%">  10             tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 11:  50%">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:hsl(0.0, 100.0%, 80%)"
                    title="Line 12: 100%">  12             quote = not quote</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 13:  50%">  13         elif not tag:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 14:  50%">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 16:  50%">  16     return out</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What happens with our <code>quote = not quote</code> "culprit" line if it is executed in passing runs, too?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">remove_html_markup</span><span class="p">(</span><span class="s1">&#39;&lt;b link=&quot;blue&quot;&gt;&lt;/b&gt;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">In which color will the <code>quote = not quote</code> "culprit" line be shown after executing the above code?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="b1834e14-82bc-11eb-b36c-acde48001122" id="b1834e14-82bc-11eb-b36c-acde48001122-1" onclick="clear_selection('b1834e14-82bc-11eb-b36c-acde48001122')">
        <label id="b1834e14-82bc-11eb-b36c-acde48001122-1-label" for="b1834e14-82bc-11eb-b36c-acde48001122-1"><span style="background-color: hsl(120.0, 50.0%, 80%)">Green</span></label><br>

        <input type="radio" name="b1834e14-82bc-11eb-b36c-acde48001122" id="b1834e14-82bc-11eb-b36c-acde48001122-2" onclick="clear_selection('b1834e14-82bc-11eb-b36c-acde48001122')">
        <label id="b1834e14-82bc-11eb-b36c-acde48001122-2-label" for="b1834e14-82bc-11eb-b36c-acde48001122-2"><span style="background-color: hsl(60.0, 100.0%, 80%)">Yellow</span></label><br>

        <input type="radio" name="b1834e14-82bc-11eb-b36c-acde48001122" id="b1834e14-82bc-11eb-b36c-acde48001122-3" onclick="clear_selection('b1834e14-82bc-11eb-b36c-acde48001122')">
        <label id="b1834e14-82bc-11eb-b36c-acde48001122-3-label" for="b1834e14-82bc-11eb-b36c-acde48001122-3"><span style="background-color: hsl(30.0, 100.0%, 80%)">Orange</span></label><br>

        <input type="radio" name="b1834e14-82bc-11eb-b36c-acde48001122" id="b1834e14-82bc-11eb-b36c-acde48001122-4" onclick="clear_selection('b1834e14-82bc-11eb-b36c-acde48001122')">
        <label id="b1834e14-82bc-11eb-b36c-acde48001122-4-label" for="b1834e14-82bc-11eb-b36c-acde48001122-4"><span style="background-color: hsl(0.0, 100.0%, 80%)">Red</span></label><br>

    </div>
    </p>
    <input id="b1834e14-82bc-11eb-b36c-acde48001122-submit" type="submit" value="Submit" onclick="check_selection('b1834e14-82bc-11eb-b36c-acde48001122', 8, 0, '999 // 333')">
    <span class="quiz_hint" id="b1834e14-82bc-11eb-b36c-acde48001122-hint"></span>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that it still is shown with an orange-red tint.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 1:  50%">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 2:  50%">   2     tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 3:  50%">   3     quote = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 4:  50%">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 6:  50%">   6     for c in s:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 7:  50%">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 66.66666666666666%, 80%)"
                    title="Line 8:   0%">   8             tag = True</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 9:  50%">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 66.66666666666666%, 80%)"
                    title="Line 10:   0%">  10             tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 11:  50%">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:hsl(30.0, 100.0%, 80%)"
                    title="Line 12:  75%">  12             quote = not quote</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 13:  50%">  13         elif not tag:</pre>
<pre style="background-color:hsl(48.0, 100.0%, 80%)"
                    title="Line 14:  60%">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 16:  50%">  16     return out</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>TODO: Having tag attributes in single quotes will spoil all fault localization</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's another example, coming right from the Tarantula paper. The <code>middle()</code> function takes three numbers <code>x</code>, <code>y</code>, and <code>z</code>, and returns the one that is neither the minimum nor the maximum of the three:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">z</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">middle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Unfortunately, <code>middle()</code> can fail:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">middle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let is see whether we can find the bug with a few additional test cases:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T3</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T3&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;DifferenceDebugger&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_debugger_middle</span><span class="p">(</span><span class="n">debugger</span><span class="p">:</span> <span class="n">T3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T3</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_fail</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that in order to collect data from multiple function invocations, you need to have a separate <code>with</code> clause for every invocation. The following will <em>not</em> work correctly:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">debugger</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">middle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_middle</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">event_table</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_markdown rendered_html output_subarea output_execute_result">

<table>
<thead><tr>
<th><code>middle</code></th>
<th><code>z=5, y=3, x=3</code></th>
<th><code>z=3, y=2, x=1</code></th>
<th><code>z=1, y=2, x=3</code></th>
<th><code>z=5, y=5, x=5</code></th>
<th><code>z=4, y=3, x=5</code></th>
<th><code>z=3, y=1, x=2</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>middle:1</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>middle:2</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>middle:3</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>middle:4</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>middle:5</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>middle:6</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td>middle:8</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>middle:9</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>middle:10</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>middle:12</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
</tr>
</tbody>
</table>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the visualization. We see that the <code>return y</code> line is the culprit here – and actually also the one to be fixed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 1:  50%">   1 def middle(x, y, z):  # type: ignore</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 2:  50%">   2     if y &lt; z:</pre>
<pre style="background-color:hsl(44.99999999999999, 100.0%, 80%)"
                    title="Line 3:  62%">   3         if x &lt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 4:   0%">   4             return y</pre>
<pre style="background-color:hsl(34.28571428571429, 100.0%, 80%)"
                    title="Line 5:  71%">   5         elif x &lt; z:</pre>
<pre style="background-color:hsl(20.000000000000004, 100.0%, 80%)"
                    title="Line 6:  83%">   6             return y</pre>
<pre title="Line 7: not executed">   7     else:
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 8:   0%">   8         if x &gt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 9:   0%">   9             return y</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 10:   0%">  10         elif x &gt; z:</pre>
<pre title="Line 11: not executed">  11             return x
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 12:   0%">  12     return z</pre>

</div>

</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>

    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">Which of the above lines should be fixed?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">

        <input type="radio" name="b18c9a5a-82bc-11eb-835f-acde48001122" id="b18c9a5a-82bc-11eb-835f-acde48001122-1" onclick="clear_selection('b18c9a5a-82bc-11eb-835f-acde48001122')">
        <label id="b18c9a5a-82bc-11eb-835f-acde48001122-1-label" for="b18c9a5a-82bc-11eb-835f-acde48001122-1"><span style="background-color: hsl(45.0, 100%, 80%)">Line 3: <code>elif x &lt; y</code></span></label><br>

        <input type="radio" name="b18c9a5a-82bc-11eb-835f-acde48001122" id="b18c9a5a-82bc-11eb-835f-acde48001122-2" onclick="clear_selection('b18c9a5a-82bc-11eb-835f-acde48001122')">
        <label id="b18c9a5a-82bc-11eb-835f-acde48001122-2-label" for="b18c9a5a-82bc-11eb-835f-acde48001122-2"><span style="background-color: hsl(34.28571428571429, 100.0%, 80%)">Line 5: <code>elif x &lt; z</code></span></label><br>

        <input type="radio" name="b18c9a5a-82bc-11eb-835f-acde48001122" id="b18c9a5a-82bc-11eb-835f-acde48001122-3" onclick="clear_selection('b18c9a5a-82bc-11eb-835f-acde48001122')">
        <label id="b18c9a5a-82bc-11eb-835f-acde48001122-3-label" for="b18c9a5a-82bc-11eb-835f-acde48001122-3"><span style="background-color: hsl(20.000000000000004, 100.0%, 80%)">Line 6: <code>return y</code></span></label><br>

        <input type="radio" name="b18c9a5a-82bc-11eb-835f-acde48001122" id="b18c9a5a-82bc-11eb-835f-acde48001122-4" onclick="clear_selection('b18c9a5a-82bc-11eb-835f-acde48001122')">
        <label id="b18c9a5a-82bc-11eb-835f-acde48001122-4-label" for="b18c9a5a-82bc-11eb-835f-acde48001122-4"><span style="background-color: hsl(120.0, 20.0%, 80%)">Line 9: <code>return y</code></span></label><br>

    </div>
    </p>
    <input id="b18c9a5a-82bc-11eb-835f-acde48001122-submit" type="submit" value="Submit" onclick="check_selection('b18c9a5a-82bc-11eb-835f-acde48001122', 8, 0, 'len(&quot; middle  &quot;.strip()[:3])')">
    <span class="quiz_hint" id="b18c9a5a-82bc-11eb-835f-acde48001122-hint"></span>
    </div>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, in the <code>middle()</code> example, the "reddest" line is also the one to be fixed.  Here is the fixed version:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">z</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">middle_fixed</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Ranking-Lines-by-Suspiciousness">Ranking Lines by Suspiciousness<a class="anchor-link" href="#Ranking-Lines-by-Suspiciousness">&#182;</a></h2><p>In a large program, there can be several locations (and events) that could be flagged as suspicious. It suffices that some large code block of say, 1,000 lines, is mostly executed in failing runs, and then all of this code block will be visualized in some shade of red.</p>
<p>To further highlight the "most suspicious" events, one idea is to use a <em>ranking</em> – that is, coming up with a list of events where those events most correlated with failures would be shown at the top. The programmer would then examine these events one by one and proceed down the list. We will show how this works for two "correlation" metrics – first the <em>Tarantula</em> metric, as introduced above, and then the <em>Ochiai</em> metric, which has shown to be one of the best "ranking" metrics.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We introduce a base class <code>RankingDebugger</code> with an abstract method <code>suspiciousness()</code> to be overloaded in subclasses. The method <code>rank()</code> returns a list of all events observed, sorted by suspiciousness, highest first.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RankingDebugger</span><span class="p">(</span><span class="n">DiscreteSpectrumDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rank events by their suspiciousness&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a list of events, sorted by suspiciousness, highest first.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">susp</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">suspiciousness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">suspiciousness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">suspiciousness</span>

        <span class="n">events</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">())</span>
        <span class="n">events</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">susp</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">events</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="The-Tarantula-Metric">The Tarantula Metric<a class="anchor-link" href="#The-Tarantula-Metric">&#182;</a></h3><p>We can use the Tarantula metric to sort lines according to their suspiciousness. The "redder" a line (a hue of 0.0), the more suspicious it is. We can simply define</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">$$
_() = 1 - ()
$$</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>where $$ is as defined above.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is exactly the <code>suspiciousness()</code> function as already implemented in our <code>ContinuousSpectrumDebugger</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We introduce the <code>TarantulaDebugger</code> class, inheriting visualization capabilities from the <code>ContinuousSpectrumDebugger</code> class as well as the suspiciousness features from the <code>RankingDebugger</code> class.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TarantulaDebugger</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">,</span> <span class="n">RankingDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spectrum-based Debugger using the Tarantula metric for suspiciousness&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us list <code>remove_html_markup()</code> with highlighted lines again:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_html</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">TarantulaDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_html</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 1:  50%">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 2:  50%">   2     tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 3:  50%">   3     quote = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 4:  50%">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 6:  50%">   6     for c in s:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 7:  50%">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 8:   0%">   8             tag = True</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 9:  50%">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 10:   0%">  10             tag = False</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 11:  50%">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:hsl(0.0, 100.0%, 80%)"
                    title="Line 12: 100%">  12             quote = not quote</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 13:  50%">  13         elif not tag:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 14:  50%">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 16:  50%">  16     return out</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's our ranking of lines, from most suspicious to least suspicious:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_html</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;remove_html_markup&#39;, 12),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 16),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 8),
 (&#39;remove_html_markup&#39;, 10)]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_html</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">tarantula_html</span><span class="o">.</span><span class="n">rank</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that the first line in the list is indeed the most suspicious; the two "green" lines come at the very end.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For the <code>middle()</code> function, we also obtain a ranking from "reddest" to "greenest".</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_middle</span> <span class="o">=</span> <span class="n">test_debugger_middle</span><span class="p">(</span><span class="n">TarantulaDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_middle</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 1:  50%">   1 def middle(x, y, z):  # type: ignore</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 2:  50%">   2     if y &lt; z:</pre>
<pre style="background-color:hsl(44.99999999999999, 100.0%, 80%)"
                    title="Line 3:  62%">   3         if x &lt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 4:   0%">   4             return y</pre>
<pre style="background-color:hsl(34.28571428571429, 100.0%, 80%)"
                    title="Line 5:  71%">   5         elif x &lt; z:</pre>
<pre style="background-color:hsl(20.000000000000004, 100.0%, 80%)"
                    title="Line 6:  83%">   6             return y</pre>
<pre title="Line 7: not executed">   7     else:
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 8:   0%">   8         if x &gt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 9:   0%">   9             return y</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 10:   0%">  10         elif x &gt; z:</pre>
<pre title="Line 11: not executed">  11             return x
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 12:   0%">  12     return z</pre>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_middle</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;middle&#39;, 6),
 (&#39;middle&#39;, 5),
 (&#39;middle&#39;, 3),
 (&#39;middle&#39;, 1),
 (&#39;middle&#39;, 2),
 (&#39;middle&#39;, 12),
 (&#39;middle&#39;, 10),
 (&#39;middle&#39;, 4),
 (&#39;middle&#39;, 9),
 (&#39;middle&#39;, 8)]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tarantula_middle</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">tarantula_middle</span><span class="o">.</span><span class="n">rank</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.8333333333333333
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="The-Ochiai-Metric">The Ochiai Metric<a class="anchor-link" href="#The-Ochiai-Metric">&#182;</a></h3><p>The <em>Ochiai</em> Metric [<a href="https://www.jstage.jst.go.jp/article/suisan1932/22/9/22_9_522/_article/-char/ja/">Akira Ochiai, 1957.</a>] first introduced in the biology domain [<a href="https://doi.org/https://doi.org/10.1590/S1415-47572004000100014">da Silva Meyer <em>et al</em>, 2004.</a>] and later applied for fault localization by Abreu et al. [<a href="https://doi.org/10.1016/j.jss.2009.06.035">Abreu <em>et al</em>, 2009.</a>], is defined as follows:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">$$
_ = \frac
{()}
{\sqrt{
\bigl(() + ()\bigr)
\times
\bigl(() + ()\bigr)
}}
$$</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>where</p>
<ul>
<li>$()$ is the number of times the event occurred in <em>failing</em> runs</li>
<li>$()$ is the number of times the event did <em>not</em> occur in failing runs</li>
<li>$()$ is the number of times the event occurred in <em>passing</em> runs.</li>
</ul>
<p>We can easily implement this formula:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/math.html" class="import" target="_blank">math</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OchiaiDebugger</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">,</span> <span class="n">RankingDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spectrum-based Debugger using the Ochiai metric for suspiciousness&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">suspiciousness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors_with_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">))</span>
        <span class="n">not_in_failed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors_without_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span><span class="p">))</span>
        <span class="n">passed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collectors_with_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">failed</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">failed</span> <span class="o">+</span> <span class="n">not_in_failed</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">failed</span> <span class="o">+</span> <span class="n">passed</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">hue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">suspiciousness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suspiciousness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">suspiciousness</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Applied on the <code>remove_html_markup()</code> function, the individual suspiciousness scores differ from Tarantula. However, we obtain a very similar visualization, and the same ranking.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_html</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">OchiaiDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_html</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 1:  57%">   1 def remove_html_markup(s):  # type: ignore</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 2:  57%">   2     tag = False</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 3:  57%">   3     quote = False</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 4:  57%">   4     out = &quot;&quot;</pre>
<pre title="Line 5: not executed">   5 &nbsp;</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 6:  57%">   6     for c in s:</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 7:  57%">   7         if c == &#x27;&lt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 8:   0%">   8             tag = True</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 9:  57%">   9         elif c == &#x27;&gt;&#x27; and not quote:</pre>
<pre style="background-color:hsl(120.0, 50.0%, 80%)"
                    title="Line 10:   0%">  10             tag = False</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 11:  57%">  11         elif c == &#x27;&quot;&#x27; or c == &quot;&#x27;&quot; and tag:</pre>
<pre style="background-color:hsl(0.0, 100.0%, 80%)"
                    title="Line 12: 100%">  12             quote = not quote</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 13:  57%">  13         elif not tag:</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 14:  57%">  14             out = out + c</pre>
<pre title="Line 15: not executed">  15 &nbsp;</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 16:  57%">  16     return out</pre>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_html</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;remove_html_markup&#39;, 12),
 (&#39;remove_html_markup&#39;, 9),
 (&#39;remove_html_markup&#39;, 4),
 (&#39;remove_html_markup&#39;, 11),
 (&#39;remove_html_markup&#39;, 6),
 (&#39;remove_html_markup&#39;, 13),
 (&#39;remove_html_markup&#39;, 1),
 (&#39;remove_html_markup&#39;, 3),
 (&#39;remove_html_markup&#39;, 16),
 (&#39;remove_html_markup&#39;, 7),
 (&#39;remove_html_markup&#39;, 14),
 (&#39;remove_html_markup&#39;, 2),
 (&#39;remove_html_markup&#39;, 8),
 (&#39;remove_html_markup&#39;, 10)]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_html</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">ochiai_html</span><span class="o">.</span><span class="n">rank</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The same observations also apply for the <code>middle()</code> function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span> <span class="o">=</span> <span class="n">test_debugger_middle</span><span class="p">(</span><span class="n">OchiaiDebugger</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(71.01020514433642, 100.0%, 80%)"
                    title="Line 1:  40%">   1 def middle(x, y, z):  # type: ignore</pre>
<pre style="background-color:hsl(71.01020514433642, 100.0%, 80%)"
                    title="Line 2:  40%">   2     if y &lt; z:</pre>
<pre style="background-color:hsl(60.0, 100.0%, 80%)"
                    title="Line 3:  50%">   3         if x &lt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 4:   0%">   4             return y</pre>
<pre style="background-color:hsl(50.7179676972449, 100.0%, 80%)"
                    title="Line 5:  57%">   5         elif x &lt; z:</pre>
<pre style="background-color:hsl(35.14718625761431, 100.0%, 80%)"
                    title="Line 6:  70%">   6             return y</pre>
<pre title="Line 7: not executed">   7     else:
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 8:   0%">   8         if x &gt; y:</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 9:   0%">   9             return y</pre>
<pre style="background-color:hsl(120.0, 20.0%, 80%)"
                    title="Line 10:   0%">  10         elif x &gt; z:</pre>
<pre title="Line 11: not executed">  11             return x
</pre>
<pre style="background-color:hsl(120.0, 40.0%, 80%)"
                    title="Line 12:   0%">  12     return z</pre>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;middle&#39;, 6),
 (&#39;middle&#39;, 5),
 (&#39;middle&#39;, 3),
 (&#39;middle&#39;, 1),
 (&#39;middle&#39;, 2),
 (&#39;middle&#39;, 12),
 (&#39;middle&#39;, 10),
 (&#39;middle&#39;, 4),
 (&#39;middle&#39;, 9),
 (&#39;middle&#39;, 8)]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span><span class="o">.</span><span class="n">suspiciousness</span><span class="p">(</span><span class="n">ochiai_middle</span><span class="o">.</span><span class="n">rank</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.7071067811865475
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="How-Useful-is-Ranking?">How Useful is Ranking?<a class="anchor-link" href="#How-Useful-is-Ranking?">&#182;</a></h3><p>So, which metric is better? The standard method to evaluate such rankings is to determine a <em>ground truth</em> – that is, the set of locations that eventually are fixed – and to check at which point in the ranking any such location occurs – the earlier, the better. In our <code>remove_html_markup()</code> and <code>middle()</code> examples, both the Tarantula and the Ochiai metric perform flawlessly, as the "culprit" line is always ranked at the top. However, this need not always be the case; the exact performance depends on the nature of the code and the observed runs. (Also, the question of whether there always is exactly one possible location where the program can be fixed is open for discussion.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>You will be surprised that over time, <em>several dozen</em> metrics have been proposed [<a href="https://doi.org/10.1109/TSE.2016.2521368">Wong <em>et al</em>, 2016.</a>], each performing somewhat better or somewhat worse depending on which benchmark they were applied on. The two metrics discussed above each have their merits – the Tarantula metric was among the first such metrics, and the Ochiai metric is generally shown to be among the most effective ones [<a href="https://doi.org/10.1016/j.jss.2009.06.035">Abreu <em>et al</em>, 2009.</a>].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While rankings can be easily <em>evaluated</em>, it is not necessarily clear whether and how much they serve programmers. As stated above, the assumption of rankings is that developers examine one potentially defective statement after another until they find the actually defective one. However, in a series of human studies with developers, Parnin and Orso [<a href="https://doi.org/10.1145/2001420.2001445">Parnin <em>et al</em>, 2011.</a>] found that this assumption may not hold:</p>
<blockquote><p>It is unclear whether developers can actually determine the faulty nature of a statement by simply looking at it, without any additional information (e.g., the state of the program when the statement was executed or the statements that were executed before or after that one).</p>
</blockquote>
<p>In their study, they found that rankings could help completing a task faster, but this effect was limited to experienced developers and simpler code. Artificially changing the rank of faulty statements had little to no effect, implying that developers would not strictly follow the ranked list of statements, but rather search through the code to understand it. At this point, a <em>visualization</em> as in the Tarantula tool can be helpful to programmers as it <em>guides</em> the search, but a <em>ranking</em> that <em>defines</em> where to search may be less useful.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Having said that, ranking has its merits – notably as it comes to informing <em>automated</em> debugging techniques. In the <a href="Repairer.html">chapter on program repair</a>, we will see how ranked lists of potentially faulty statements tell automated repair techniques where to try to repair the program first. And once such a repair is successful, we have a very strong indication on where and how the program could be fixed!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Using-Large-Test-Suites">Using Large Test Suites<a class="anchor-link" href="#Using-Large-Test-Suites">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In fault localization, the larger and the more thorough the test suite, the higher the precision. Let us try out what happens if we extend the <code>middle()</code> test suite with additional test cases.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>middle_testcase()</code> returns a random input for <code>middle()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle_testcase</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">middle_testcase</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(1, 9, 9), (0, 9, 2), (9, 0, 4), (7, 2, 1), (6, 1, 5)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>middle_test()</code> simply checks if <code>middle()</code> operates correctly – by placing <code>x</code>, <code>y</code>, and <code>z</code> in a list, sorting it, and checking the middle argument. If <code>middle()</code> fails, <code>middle_test()</code> raises an exception.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle_test</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">m</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">middle_test</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">middle_test</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-1-ae2957225406&gt;&#34;, line 2, in &lt;module&gt;
    middle_test(2, 1, 3)
  File &#34;&lt;ipython-input-1-e1407680b9f2&gt;&#34;, line 3, in middle_test
    assert m == sorted([x, y, z])[1]
AssertionError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>middle_passing_testcase()</code> searches and returns a triple <code>x</code>, <code>y</code>, <code>z</code> that causes <code>middle_test()</code> to pass.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle_passing_testcase</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">middle_testcase</span><span class="p">()</span>
            <span class="n">middle_test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">middle_passing_testcase</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;middle(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>middle(2, 6, 7) = 6
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The function <code>middle_failing_testcase()</code> does the same; but its triple <code>x</code>, <code>y</code>, <code>z</code> causes <code>middle_test()</code> to fail.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">middle_failing_testcase</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">middle_testcase</span><span class="p">()</span>
            <span class="n">middle_test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">middle_failing_testcase</span><span class="p">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;middle(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>middle(5, 4, 6) = 4
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With these, we can define two sets of test cases, each with 100 inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">MIDDLE_TESTS</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">MIDDLE_PASSING_TESTCASES</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle_passing_testcase</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MIDDLE_TESTS</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">MIDDLE_FAILING_TESTCASES</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle_failing_testcase</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MIDDLE_TESTS</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us run the <code>OchiaiDebugger</code> with these two test sets</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span> <span class="o">=</span> <span class="n">OchiaiDebugger</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">MIDDLE_PASSING_TESTCASES</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ochiai_middle</span><span class="o">.</span><span class="n">collect_pass</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">MIDDLE_FAILING_TESTCASES</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ochiai_middle</span><span class="o">.</span><span class="n">collect_fail</span><span class="p">():</span>
        <span class="n">middle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ochiai_middle</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<pre style="background-color:hsl(35.14718625761431, 100.0%, 80%)"
                    title="Line 1:  70%">   1 def middle(x, y, z):  # type: ignore</pre>
<pre style="background-color:hsl(35.14718625761431, 100.0%, 80%)"
                    title="Line 2:  70%">   2     if y &lt; z:</pre>
<pre style="background-color:hsl(18.2173284384035, 100.0%, 80%)"
                    title="Line 3:  84%">   3         if x &lt; y:</pre>
<pre style="background-color:hsl(120.0, 12.0%, 80%)"
                    title="Line 4:   0%">   4             return y</pre>
<pre style="background-color:hsl(13.517218870066348, 100.0%, 80%)"
                    title="Line 5:  88%">   5         elif x &lt; z:</pre>
<pre style="background-color:hsl(2.3303189170895866, 100.0%, 80%)"
                    title="Line 6:  98%">   6             return y</pre>
<pre title="Line 7: not executed">   7     else:
</pre>
<pre style="background-color:hsl(120.0, 61.0%, 80%)"
                    title="Line 8:   0%">   8         if x &gt; y:</pre>
<pre style="background-color:hsl(120.0, 24.0%, 80%)"
                    title="Line 9:   0%">   9             return y</pre>
<pre style="background-color:hsl(120.0, 37.0%, 80%)"
                    title="Line 10:   0%">  10         elif x &gt; z:</pre>
<pre style="background-color:hsl(120.0, 14.000000000000002%, 80%)"
                    title="Line 11:   0%">  11             return x</pre>
<pre style="background-color:hsl(120.0, 46.0%, 80%)"
                    title="Line 12:   0%">  12     return z</pre>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that the "culprit" line is still the most likely to be fixed, but the two conditions leading to the error (<code>x &lt; y</code> and <code>x &lt; z</code>) are also listed as potentially faulty. That is because the error might also be fixed be changing these conditions – although this would result in a more complex fix.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Other-Events-besides-Coverage">Other Events besides Coverage<a class="anchor-link" href="#Other-Events-besides-Coverage">&#182;</a></h2><p>We close this chapter with two directions for further thought. If you wondered why in the above code, we were mostly talking about <code>events</code> rather than lines covered, that is because our framework allows for tracking arbitrary events, not just coverage. In fact, any data item a collector can extract from the execution can be used for correlation analysis. (It may not be so easily visualized, though.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example. We define a <code>ValueCollector</code> class that collects pairs of (local) variables and their values during execution. Its <code>events()</code> method then returns the set of all these pairs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ValueCollector</span><span class="p">(</span><span class="n">Collector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;A class to collect local variables and their values.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">local_vars</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">local_vars</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">local_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A set of (variable, value) pairs observed&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we apply this collector on our set of HTML test cases, these are all the events that we obtain – essentially all variables and all values ever seen:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ContinuousSpectrumDebugger</span><span class="p">(</span><span class="n">ValueCollector</span><span class="p">))</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">all_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>s = &#39;&#34;abc&#34;&#39;
s = &#39;&lt;b&gt;abc&lt;/b&gt;&#39;
quote = False
c = &#39;&lt;&#39;
c = &#39;/&#39;
c = &#39;b&#39;
out = &#39;a&#39;
c = &#39;&gt;&#39;
c = &#39;c&#39;
c = &#39;a&#39;
s = &#39;abc&#39;
tag = False
tag = True
out = &#39;ab&#39;
out = &#39;abc&#39;
quote = True
c = &#39;&#34;&#39;
out = &#39;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, some of these events only occur in the failing run:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">only_fail_events</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>quote = True
s = &#39;&#34;abc&#34;&#39;
c = &#39;&#34;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Some of these differences are spurious – the string <code>"abc"</code> (with quotes) only occurs in the failing run – but others, such as <code>quote</code> being True and <code>c</code> containing a single quote are actually relevant for explaining when the failure comes to be.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can even visualize the suspiciousness of the individual events, setting the (so far undiscussed) <code>color</code> flag for producing an event table:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span><span class="o">.</span><span class="n">event_table</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_markdown rendered_html output_subarea output_execute_result">

<table>
<thead><tr>
<th><code>remove_html_markup</code></th>
<th><code>s='abc'</code></th>
<th><code>s='&lt;b&gt;abc&lt;/b&gt;'</code></th>
<th><code>s='"abc"'</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><samp style="background-color: hsl(0.0, 100.0%, 80%)" title="100%">         c = &#x27;&quot;&#x27;</samp></td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">         c = &#x27;/&#x27;</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">         c = &#x27;&lt;&#x27;</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">         c = &#x27;&gt;&#x27;</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">         c = &#x27;a&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">         c = &#x27;b&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">         c = &#x27;c&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">        out = &#x27;&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">       out = &#x27;a&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">      out = &#x27;ab&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">     out = &#x27;abc&#x27;</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">   quote = False</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(0.0, 100.0%, 80%)" title="100%">    quote = True</samp></td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(0.0, 100.0%, 80%)" title="100%">     s = &#x27;&quot;abc&quot;&#x27;</samp></td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">s = &#x27;&lt;b&gt;abc&lt;/b&gt;&#x27;</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">       s = &#x27;abc&#x27;</samp></td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><samp style="background-color: hsl(60.0, 100.0%, 80%)" title=" 50%">     tag = False</samp></td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td><samp style="background-color: hsl(120.0, 50.0%, 80%)" title="  0%">      tag = True</samp></td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
</tbody>
</table>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There are many ways one can continue from here.</p>
<ul>
<li>Rather than checking for concrete values, one could check for more <em>abstract properties</em>, for instance – what is the sign of the value? What is the length of the string? </li>
<li>One could check for specifics of the <em>control flow</em> – is the loop taken? How many times?</li>
<li>One could check for specifics of the <em>information flow</em> – which values flow from one variable to another?</li>
</ul>
<p>There are lots of properties that all could be related to failures – and if we happen to check for the right one, we may obtain a much crisper definition of what causes the failure. We will come up with more ideas on properties to check as it comes to <a href="SpecificationMining,ipynb">mining specifications</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Training-Classifiers">Training Classifiers<a class="anchor-link" href="#Training-Classifiers">&#182;</a></h2><p>The metrics we have discussed so far are pretty <em>generic</em> – that is, they are fixed no matter how the actual event space is structured. The field of <em>machine learning</em> has come up with techniques that learn <em>classifiers</em> from a given set of data – classifiers that are trained from labeled data and then can predict labels for new data sets. In our case, the labels are test outcomes (PASS and FAIL), whereas the data would be features of the events observed.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A classifier by itself is not immediately useful for debugging (although it could predict whether future inputs will fail or not). Some classifiers, however, have great <em>diagnostic</em> quality; that is, they can <em>explain</em> how their classification comes to be. <a href="https://scikit-learn.org/stable/modules/tree.html">Decision trees</a> fall into this very category.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A decision tree contains a number of <em>nodes</em>, each one associated with a predicate. Depending on whether the predicate is true or false, we follow the given "true" or "false" branch to end up in the next node, which again contains a predicate. Eventually, we end up in the outcome predicted by the tree. The neat thing is that the node predicates actually give important hints on the circumstances that are <em>most relevant</em> for deciding the outcome.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate this with an example. We build a class <code>ClassifyingDebugger</code> that trains a decision tree from the events collected. To this end, we need to set up our input data such that it can be fed into a classifier.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We start with identifying our <em>samples</em> (runs) and the respective <em>labels</em> (outcomes). All values have to be encoded into numerical values.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">DifferenceDebugger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A debugger implementing a decision tree for events&quot;&quot;&quot;</span>

    <span class="n">PASS_VALUE</span> <span class="o">=</span> <span class="o">+</span><span class="mf">1.0</span>
    <span class="n">FAIL_VALUE</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">samples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pass_collectors</span><span class="p">():</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">id</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS_VALUE</span>
        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">fail_collectors</span><span class="p">():</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">id</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL_VALUE</span>
        <span class="k">return</span> <span class="n">samples</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">samples</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#34;remove_html_markup(s=&#39;abc&#39;)&#34;: 1.0,
 &#34;remove_html_markup(s=&#39;&lt;b&gt;abc&lt;/b&gt;&#39;)&#34;: 1.0,
 &#39;remove_html_markup(s=\&#39;&#34;abc&#34;\&#39;)&#39;: -1.0}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we identify the <em>features</em>, which in our case is the set of lines executed in each sample:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">pass_collectors</span><span class="p">():</span>
            <span class="n">features</span><span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">id</span><span class="p">()]</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">collector</span> <span class="ow">in</span> <span class="n">debugger</span><span class="o">.</span><span class="n">fail_collectors</span><span class="p">():</span>
            <span class="n">features</span><span class="p">[</span><span class="n">collector</span><span class="o">.</span><span class="n">id</span><span class="p">()]</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">features</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">features</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#34;remove_html_markup(s=&#39;abc&#39;)&#34;: {(&#39;remove_html_markup&#39;, 1),
  (&#39;remove_html_markup&#39;, 2),
  (&#39;remove_html_markup&#39;, 3),
  (&#39;remove_html_markup&#39;, 4),
  (&#39;remove_html_markup&#39;, 6),
  (&#39;remove_html_markup&#39;, 7),
  (&#39;remove_html_markup&#39;, 9),
  (&#39;remove_html_markup&#39;, 11),
  (&#39;remove_html_markup&#39;, 13),
  (&#39;remove_html_markup&#39;, 14),
  (&#39;remove_html_markup&#39;, 16)},
 &#34;remove_html_markup(s=&#39;&lt;b&gt;abc&lt;/b&gt;&#39;)&#34;: {(&#39;remove_html_markup&#39;, 1),
  (&#39;remove_html_markup&#39;, 2),
  (&#39;remove_html_markup&#39;, 3),
  (&#39;remove_html_markup&#39;, 4),
  (&#39;remove_html_markup&#39;, 6),
  (&#39;remove_html_markup&#39;, 7),
  (&#39;remove_html_markup&#39;, 8),
  (&#39;remove_html_markup&#39;, 9),
  (&#39;remove_html_markup&#39;, 10),
  (&#39;remove_html_markup&#39;, 11),
  (&#39;remove_html_markup&#39;, 13),
  (&#39;remove_html_markup&#39;, 14),
  (&#39;remove_html_markup&#39;, 16)},
 &#39;remove_html_markup(s=\&#39;&#34;abc&#34;\&#39;)&#39;: {(&#39;remove_html_markup&#39;, 1),
  (&#39;remove_html_markup&#39;, 2),
  (&#39;remove_html_markup&#39;, 3),
  (&#39;remove_html_markup&#39;, 4),
  (&#39;remove_html_markup&#39;, 6),
  (&#39;remove_html_markup&#39;, 7),
  (&#39;remove_html_markup&#39;, 9),
  (&#39;remove_html_markup&#39;, 11),
  (&#39;remove_html_markup&#39;, 12),
  (&#39;remove_html_markup&#39;, 13),
  (&#39;remove_html_markup&#39;, 14),
  (&#39;remove_html_markup&#39;, 16)}}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>All our features have names, which must be strings.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">()]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">feature_names</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#34;(&#39;remove_html_markup&#39;, 9)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 4)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 11)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 6)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 13)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 1)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 8)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 3)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 10)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 16)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 12)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 7)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 14)&#34;,
 &#34;(&#39;remove_html_markup&#39;, 2)&#34;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we define the <em>shape</em> for an individual sample, which is a value of +1 or -1 for each feature seen (i.e., +1 if the line was covered, -1 if not).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_events</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">[</span><span class="n">sample</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="p">[</span><span class="o">+</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="s2">&quot;remove_html_markup(s=&#39;abc&#39;)&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our input X for the classifier now is a list of such shapes, one for each sample.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">X</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">X</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0],
 [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0],
 [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our input Y for the classifier, in contrast, is the list of labels, again indexed by sample.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">Y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">+=</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">Y</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">Y</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1.0, 1.0, -1.0]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now have all our data ready to be fit into a tree classifier. The method <code>classifier()</code> creates and returns the (tree) classifier for the observed runs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://scikit-learn.org/" class="import" target="_blank">sklearn.tree</a></span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">export_text</span><span class="p">,</span> <span class="n">export_graphviz</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionTreeClassifier</span><span class="p">:</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
        <span class="n">classifier</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">classifier</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define a special method to show classifiers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://graphviz.readthedocs.io/" class="import" target="_blank">graphviz</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ClassifyingDebugger</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">show_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">dot_data</span> <span class="o">=</span> <span class="n">export_graphviz</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">feature_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">(),</span>
                                   <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;PASS&quot;</span><span class="p">],</span>
                                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                   <span class="n">node_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">impurity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">proportion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">special_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">dot_data</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the tree we get for our <code>remove_html_markup()</code> tests. The top predicate is whether the "culprit" line was executed (-1 means no, +1 means yes). If not (-1), the outcome is PASS. Otherwise, the outcome is TRUE.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">debugger</span> <span class="o">=</span> <span class="n">test_debugger_html</span><span class="p">(</span><span class="n">ClassifyingDebugger</span><span class="p">())</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">debugger</span><span class="o">.</span><span class="n">classifier</span><span class="p">()</span>
<span class="n">debugger</span><span class="o">.</span><span class="n">show_classifier</span><span class="p">(</span><span class="n">classifier</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Tree Pages: 1 -->
<svg width="233pt" height="165pt"
 viewBox="0.00 0.00 233.00 165.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 161)">
<title>Tree</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-161 229,-161 229,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<path fill="none" stroke="#000000" d="M213,-157C213,-157 12,-157 12,-157 6,-157 0,-151 0,-145 0,-145 0,-101 0,-101 0,-95 6,-89 12,-89 12,-89 213,-89 213,-89 219,-89 225,-95 225,-101 225,-101 225,-145 225,-145 225,-151 219,-157 213,-157"/>
<text text-anchor="start" x="8" y="-141.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">(&#39;remove_html_markup&#39;, 12) ≤ 0.0</text>
<text text-anchor="start" x="88.5" y="-126.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">100.0%</text>
<text text-anchor="start" x="69.5" y="-111.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">[0.333, 0.667]</text>
<text text-anchor="start" x="93.5" y="-96.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">PASS</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<path fill="none" stroke="#000000" d="M92,-53C92,-53 45,-53 45,-53 39,-53 33,-47 33,-41 33,-41 33,-12 33,-12 33,-6 39,0 45,0 45,0 92,0 92,0 98,0 104,-6 104,-12 104,-12 104,-41 104,-41 104,-47 98,-53 92,-53"/>
<text text-anchor="start" x="48.5" y="-37.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">66.7%</text>
<text text-anchor="start" x="41" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">[0.0, 1.0]</text>
<text text-anchor="start" x="49.5" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">PASS</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M96.9872,-88.9777C93.0626,-80.3702 88.8354,-71.0992 84.8698,-62.402"/>
<polygon fill="#000000" stroke="#000000" points="88.0295,-60.8952 80.6962,-53.2485 81.6603,-63.7994 88.0295,-60.8952"/>
<text text-anchor="middle" x="71.9455" y="-72.967" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">True</text>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<path fill="none" stroke="#000000" d="M181,-53C181,-53 134,-53 134,-53 128,-53 122,-47 122,-41 122,-41 122,-12 122,-12 122,-6 128,0 134,0 134,0 181,0 181,0 187,0 193,-6 193,-12 193,-12 193,-41 193,-41 193,-47 187,-53 181,-53"/>
<text text-anchor="start" x="137.5" y="-37.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">33.3%</text>
<text text-anchor="start" x="130" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">[1.0, 0.0]</text>
<text text-anchor="start" x="142.5" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">FAIL</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M128.3653,-88.9777C132.3792,-80.3702 136.7025,-71.0992 140.7581,-62.402"/>
<polygon fill="#000000" stroke="#000000" points="143.9723,-63.7907 145.0266,-53.2485 137.6282,-60.8323 143.9723,-63.7907"/>
<text text-anchor="middle" x="153.5769" y="-73.0409" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">False</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can even use our classifier to predict the outcome of additional runs. If, for instance, we execute all lines except for, say, Line 7, 9, and 11, our tree classifier would predict failure – because the "culprit" line 12 is executed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>array([1.])
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, there are many ways to continue from here. Which events should we train the classifier from? How do classifiers compare in their performance and diagnostic quality? There are lots of possibilities left to explore, and we only begin to realize the potential for automated debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Correlations</em> between execution events and outcomes (pass/fail) can make important hints for debugging</li>
<li>Events occurring only (or mostly) during failing runs can be <em>highlighted</em> and <em>ranked</em> to guide the search</li>
<li>Important hints include whether the <em>execution of specific code locations</em> correlates with failure</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>Chapters that build on this one include</p>
<ul>
<li><a href="DynamicInvariants.html">how to determine invariants that correlate with failures</a></li>
<li><a href="Repairer.html">how to automatically repair programs</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>The seminal works on statistical debugging are two papers:</p>
<ul>
<li>"Visualization of Test Information to Assist Fault Localization" [<a href="https://doi.org/10.1145/581339.581397">Jones <em>et al</em>, 2002.</a>] by James Jones, Mary Jean Harrold, and John Stasko introducing Tarantula and its visualization. The paper won an ACM SIGSOFT 10-year impact award.</li>
<li>"Bug Isolation via Remote Program Sampling" by Ben Liblit, Alex Aiken, Alice X. Zheng, and Michael I. Jordan, introducing the term "Statistical debugging". Liblit won the ACM Doctoral Dissertation Award for this work.</li>
</ul>
<p>The Ochiai metric for fault localization was introduced by [<a href="https://doi.org/10.1016/j.jss.2009.06.035">Abreu <em>et al</em>, 2009.</a>]. The overview by Wong et al. [<a href="https://doi.org/10.1109/TSE.2016.2521368">Wong <em>et al</em>, 2016.</a>] gives a comprehensive overview on the field of statistical fault localization.</p>
<p>The study by Parnin and Orso [<a href="https://doi.org/10.1145/2001420.2001445">Parnin <em>et al</em>, 2011.</a>] is a must to understand the limitations of the technique.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-A-Postcondition-for-Middle">Exercise 1: A Postcondition for Middle<a class="anchor-link" href="#Exercise-1:-A-Postcondition-for-Middle">&#182;</a></h3><p>What would be a postcondition for <code>middle()</code>? How can you check it?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/debuggingbook/master?filepath=docs/beta/notebooks/StatisticalDebugger.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Statistical-Dependencies">Exercise 2: Statistical Dependencies<a class="anchor-link" href="#Exercise-2:-Statistical-Dependencies">&#182;</a></h3><p>Using the dependencies from <a href="Slicer.html">the chapter on slicing</a>, can you determine which specific data or control dependencies correlate with failure?</p>
</div>
</div>
</div>
</div>

        
<p class="imprint">
<img style="float:right" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License">
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target=_blank>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/uds-se/debuggingbook/blob/master/LICENSE.md#mit-license">MIT License</a>.
<a href="https://github.com/uds-se/debuggingbook/commits/master/notebooks/StatisticalDebugger.ipynb" target=_blank)>Last change: 2021-03-06 12:19:25+01:00</a> &bull; 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> &bull;
<a href="https://cispa.de/en/impressum" target=_blank>Imprint</a>
</p>

<script>
function revealCitation() {
    var c = document.getElementById("citation");
    c.style.display = "block";
}
</script>

<div id="citation" class="citation" style="display: none;">
<a name="citation"></a>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller: "<a href="https://www.debuggingbook.org/beta/html/StatisticalDebugger.html">Statistical Debugging</a>".  In Andreas Zeller, "<a href="https://www.debuggingbook.org/beta/">The Debugging Book</a>", <a href="https://www.debuggingbook.org/beta/html/StatisticalDebugger.html">https://www.debuggingbook.org/beta/html/StatisticalDebugger.html</a>.  Retrieved 2021-03-06 12:19:25+01:00.
</p>
<pre>
@incollection{debuggingbook2021:StatisticalDebugger,
    author = {Andreas Zeller},
    booktitle = {The Debugging Book},
    title = {Statistical Debugging},
    year = {2021},
    publisher = {CISPA Helmholtz Center for Information Security},
    howpublished = {\url{https://www.debuggingbook.org/beta/html/StatisticalDebugger.html}},
    note = {Retrieved 2021-03-06 12:19:25+01:00},
    url = {https://www.debuggingbook.org/beta/html/StatisticalDebugger.html},
    urldate = {2021-03-06 12:19:25+01:00}
}
</pre>
</div>

      </div>
    </div>
    </article>

 </body>

</html>